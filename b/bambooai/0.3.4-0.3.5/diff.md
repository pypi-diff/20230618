# Comparing `tmp/bambooai-0.3.4.tar.gz` & `tmp/bambooai-0.3.5.tar.gz`

## filetype from file(1)

```diff
@@ -1 +1 @@
-gzip compressed data, was "bambooai-0.3.4.tar", last modified: Sun Jun 18 06:48:38 2023, max compression
+gzip compressed data, was "bambooai-0.3.5.tar", last modified: Sun Jun 18 07:11:15 2023, max compression
```

## Comparing `bambooai-0.3.4.tar` & `bambooai-0.3.5.tar`

### file list

```diff
@@ -1,16 +1,16 @@
-drwxrwxrwx   0        0        0        0 2023-06-18 06:48:38.720979 bambooai-0.3.4/
--rw-rw-rw-   0        0        0     7966 2023-06-18 06:48:38.719975 bambooai-0.3.4/PKG-INFO
--rw-rw-rw-   0        0        0     7430 2023-06-18 06:44:01.000000 bambooai-0.3.4/README.md
-drwxrwxrwx   0        0        0        0 2023-06-18 06:48:38.686757 bambooai-0.3.4/bambooai/
--rw-rw-rw-   0        0        0       79 2023-06-18 06:42:14.000000 bambooai-0.3.4/bambooai/__init__.py
--rw-rw-rw-   0        0        0    26085 2023-06-18 06:39:28.000000 bambooai-0.3.4/bambooai/bambooai.py
--rw-rw-rw-   0        0        0     1340 2023-06-17 08:09:42.000000 bambooai-0.3.4/bambooai/func_calls.py
--rw-rw-rw-   0        0        0     6692 2023-06-18 02:03:23.000000 bambooai-0.3.4/bambooai/prompts.py
-drwxrwxrwx   0        0        0        0 2023-06-18 06:48:38.718705 bambooai-0.3.4/bambooai.egg-info/
--rw-rw-rw-   0        0        0     7966 2023-06-18 06:48:38.000000 bambooai-0.3.4/bambooai.egg-info/PKG-INFO
--rw-rw-rw-   0        0        0      262 2023-06-18 06:48:38.000000 bambooai-0.3.4/bambooai.egg-info/SOURCES.txt
--rw-rw-rw-   0        0        0        1 2023-06-18 06:48:38.000000 bambooai-0.3.4/bambooai.egg-info/dependency_links.txt
--rw-rw-rw-   0        0        0       24 2023-06-18 06:48:38.000000 bambooai-0.3.4/bambooai.egg-info/requires.txt
--rw-rw-rw-   0        0        0        9 2023-06-18 06:48:38.000000 bambooai-0.3.4/bambooai.egg-info/top_level.txt
--rw-rw-rw-   0        0        0       42 2023-06-18 06:48:38.720979 bambooai-0.3.4/setup.cfg
--rw-rw-rw-   0        0        0      702 2023-06-18 06:43:04.000000 bambooai-0.3.4/setup.py
+drwxrwxrwx   0        0        0        0 2023-06-18 07:11:15.404997 bambooai-0.3.5/
+-rw-rw-rw-   0        0        0     7966 2023-06-18 07:11:15.404997 bambooai-0.3.5/PKG-INFO
+-rw-rw-rw-   0        0        0     7430 2023-06-18 06:44:01.000000 bambooai-0.3.5/README.md
+drwxrwxrwx   0        0        0        0 2023-06-18 07:11:15.367997 bambooai-0.3.5/bambooai/
+-rw-rw-rw-   0        0        0       79 2023-06-18 06:42:14.000000 bambooai-0.3.5/bambooai/__init__.py
+-rw-rw-rw-   0        0        0    26341 2023-06-18 07:00:30.000000 bambooai-0.3.5/bambooai/bambooai.py
+-rw-rw-rw-   0        0        0     1340 2023-06-17 08:09:42.000000 bambooai-0.3.5/bambooai/func_calls.py
+-rw-rw-rw-   0        0        0     6692 2023-06-18 02:03:23.000000 bambooai-0.3.5/bambooai/prompts.py
+drwxrwxrwx   0        0        0        0 2023-06-18 07:11:15.402996 bambooai-0.3.5/bambooai.egg-info/
+-rw-rw-rw-   0        0        0     7966 2023-06-18 07:11:15.000000 bambooai-0.3.5/bambooai.egg-info/PKG-INFO
+-rw-rw-rw-   0        0        0      262 2023-06-18 07:11:15.000000 bambooai-0.3.5/bambooai.egg-info/SOURCES.txt
+-rw-rw-rw-   0        0        0        1 2023-06-18 07:11:15.000000 bambooai-0.3.5/bambooai.egg-info/dependency_links.txt
+-rw-rw-rw-   0        0        0       24 2023-06-18 07:11:15.000000 bambooai-0.3.5/bambooai.egg-info/requires.txt
+-rw-rw-rw-   0        0        0        9 2023-06-18 07:11:15.000000 bambooai-0.3.5/bambooai.egg-info/top_level.txt
+-rw-rw-rw-   0        0        0       42 2023-06-18 07:11:15.405997 bambooai-0.3.5/setup.cfg
+-rw-rw-rw-   0        0        0      702 2023-06-18 07:09:13.000000 bambooai-0.3.5/setup.py
```

### Comparing `bambooai-0.3.4/PKG-INFO` & `bambooai-0.3.5/PKG-INFO`

 * *Files 0% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: bambooai
-Version: 0.3.4
+Version: 0.3.5
 Summary: A lightweight library for working with pandas dataframes using natural language queries
 Home-page: UNKNOWN
 Author: Palo Galko
 License: UNKNOWN
 Platform: UNKNOWN
 Classifier: Development Status :: 3 - Alpha
 Classifier: License :: OSI Approved :: MIT License
```

### Comparing `bambooai-0.3.4/README.md` & `bambooai-0.3.5/README.md`

 * *Files identical despite different names*

### Comparing `bambooai-0.3.4/bambooai/bambooai.py` & `bambooai-0.3.5/bambooai/bambooai.py`

 * *Files 1% similar despite different names*

```diff
@@ -1040,592 +1040,608 @@
 000040f0: 7369 6e67 2074 696d 6520 616e 6420 636f  sing time and co
 00004100: 7374 0d0a 2020 2020 2020 2020 2020 2020  st..            
 00004110: 2020 2020 6966 2073 656c 662e 6c6c 6d5f      if self.llm_
 00004120: 7377 6974 6368 3a0d 0a20 2020 2020 2020  switch:..       
 00004130: 2020 2020 2020 2020 2020 2020 206c 6c6d               llm
 00004140: 5f63 6173 6361 6465 203d 2054 7275 650d  _cascade = True.
 00004150: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00004160: 2072 616e 6b20 3d20 7365 6c66 2e72 616e   rank = self.ran
-00004170: 6b5f 636f 6465 2863 6f64 652c 7461 736b  k_code(code,task
-00004180: 2c6c 6c6d 5f63 6173 6361 6465 3d6c 6c6d  ,llm_cascade=llm
-00004190: 5f63 6173 6361 6465 290d 0a20 2020 2020  _cascade)..     
-000041a0: 2020 2020 2020 2065 6c73 653a 0d0a 2020         else:..  
-000041b0: 2020 2020 2020 2020 2020 2020 2020 7261                ra
-000041c0: 6e6b 203d 2022 220d 0a0d 0a20 2020 2020  nk = ""....     
-000041d0: 2020 2020 2020 2064 6973 706c 6179 5f72         display_r
-000041e0: 6573 756c 7473 2861 6e73 7765 722c 2063  esults(answer, c
-000041f0: 6f64 652c 2072 616e 6b2c 2074 6f74 616c  ode, rank, total
-00004200: 5f74 6f6b 656e 735f 7573 6564 5f73 756d  _tokens_used_sum
-00004210: 290d 0a20 2020 2020 2020 2020 2020 2072  )..            r
-00004220: 6574 7572 6e0d 0a20 2020 2020 2020 200d  eturn..        .
-00004230: 0a20 2020 2020 2020 2023 2053 7461 7274  .        # Start
-00004240: 2061 6e20 696e 6669 6e69 7465 206c 6f6f   an infinite loo
-00004250: 7020 746f 206b 6565 7020 6173 6b69 6e67  p to keep asking
-00004260: 2074 6865 2075 7365 7220 666f 7220 7175   the user for qu
-00004270: 6573 7469 6f6e 730d 0a20 2020 2020 2020  estions..       
-00004280: 2066 6972 7374 5f69 7465 7261 7469 6f6e   first_iteration
-00004290: 203d 2054 7275 6520 2023 2046 6c61 6720   = True  # Flag 
-000042a0: 666f 7220 7468 6520 6669 7273 7420 6974  for the first it
-000042b0: 6572 6174 696f 6e20 6f66 2074 6865 206c  eration of the l
-000042c0: 6f6f 700d 0a20 2020 2020 2020 2077 6869  oop..        whi
-000042d0: 6c65 2054 7275 653a 0d0a 2020 2020 2020  le True:..      
-000042e0: 2020 2020 2020 2320 5072 6f6d 7074 2074        # Prompt t
-000042f0: 6865 2075 7365 7220 746f 2065 6e74 6572  he user to enter
-00004300: 2061 2071 7565 7374 696f 6e20 6f72 2074   a question or t
-00004310: 7970 6520 2765 7869 7427 2074 6f20 7175  ype 'exit' to qu
-00004320: 6974 0d0a 2020 2020 2020 2020 2020 2020  it..            
-00004330: 6966 2027 6970 796b 6572 6e65 6c27 2069  if 'ipykernel' i
-00004340: 6e20 7379 732e 6d6f 6475 6c65 733a 0d0a  n sys.modules:..
-00004350: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004360: 6469 7370 6c61 7928 4854 4d4c 2827 3c62  display(HTML('<b
-00004370: 2073 7479 6c65 3d22 636f 6c6f 723a 626c   style="color:bl
-00004380: 7565 3b22 3e45 6e74 6572 2079 6f75 7220  ue;">Enter your 
-00004390: 7175 6573 7469 6f6e 206f 7220 7479 7065  question or type
-000043a0: 205c 2765 7869 745c 2720 746f 2071 7569   \'exit\' to qui
-000043b0: 743a 3c2f 623e 2729 290d 0a20 2020 2020  t:</b>'))..     
-000043c0: 2020 2020 2020 2020 2020 2074 696d 652e             time.
-000043d0: 736c 6565 7028 3129 0d0a 2020 2020 2020  sleep(1)..      
-000043e0: 2020 2020 2020 2020 2020 7175 6573 7469            questi
-000043f0: 6f6e 203d 2069 6e70 7574 2829 0d0a 2020  on = input()..  
-00004400: 2020 2020 2020 2020 2020 656c 7365 3a0d            else:.
-00004410: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00004420: 2063 7072 696e 7428 225c 6e45 6e74 6572   cprint("\nEnter
-00004430: 2079 6f75 7220 7175 6573 7469 6f6e 206f   your question o
-00004440: 7220 7479 7065 2027 6578 6974 2720 746f  r type 'exit' to
-00004450: 2071 7569 743a 222c 2027 626c 7565 272c   quit:", 'blue',
-00004460: 2061 7474 7273 3d5b 2762 6f6c 6427 5d29   attrs=['bold'])
-00004470: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00004480: 2020 7175 6573 7469 6f6e 203d 2069 6e70    question = inp
-00004490: 7574 2829 0d0a 0d0a 2020 2020 2020 2020  ut()....        
-000044a0: 2020 2020 2320 4966 2074 6865 2075 7365      # If the use
-000044b0: 7220 7479 7065 7320 2765 7869 7427 2c20  r types 'exit', 
-000044c0: 6272 6561 6b20 6f75 7420 6f66 2074 6865  break out of the
-000044d0: 206c 6f6f 700d 0a20 2020 2020 2020 2020   loop..         
-000044e0: 2020 2069 6620 7175 6573 7469 6f6e 2e73     if question.s
-000044f0: 7472 6970 2829 2e6c 6f77 6572 2829 203d  trip().lower() =
-00004500: 3d20 2765 7869 7427 3a0d 0a20 2020 2020  = 'exit':..     
-00004510: 2020 2020 2020 2020 2020 2062 7265 616b             break
-00004520: 0d0a 0d0a 2020 2020 2020 2020 2020 2020  ....            
-00004530: 6966 2066 6972 7374 5f69 7465 7261 7469  if first_iterati
-00004540: 6f6e 3a0d 0a20 2020 2020 2020 2020 2020  on:..           
-00004550: 2020 2020 2023 2049 6e69 7469 616c 697a       # Initializ
-00004560: 6520 7468 6520 6d65 7373 6167 6573 206c  e the messages l
-00004570: 6973 7420 7769 7468 2061 2073 7973 7465  ist with a syste
-00004580: 6d20 6d65 7373 6167 6520 636f 6e74 6169  m message contai
-00004590: 6e69 6e67 2074 6865 2074 6173 6b20 7072  ning the task pr
-000045a0: 6f6d 7074 0d0a 2020 2020 2020 2020 2020  ompt..          
-000045b0: 2020 2020 2020 6d65 7373 6167 6573 203d        messages =
-000045c0: 205b 7b22 726f 6c65 223a 2022 7379 7374   [{"role": "syst
-000045d0: 656d 222c 2022 636f 6e74 656e 7422 3a20  em", "content": 
-000045e0: 7365 6c66 2e73 7973 7465 6d5f 7461 736b  self.system_task
-000045f0: 2e66 6f72 6d61 7428 7175 6573 7469 6f6e  .format(question
-00004600: 297d 5d0d 0a20 2020 2020 2020 2020 2020  )}]..           
-00004610: 2020 2020 2023 2049 6e69 7469 616c 697a       # Initializ
-00004620: 6520 7468 6520 6576 616c 5f6d 6573 7361  e the eval_messa
-00004630: 6765 7320 6c69 7374 0d0a 2020 2020 2020  ges list..      
-00004640: 2020 2020 2020 2020 2020 6576 616c 5f6d            eval_m
-00004650: 6573 7361 6765 7320 3d20 5b5d 0d0a 2020  essages = []..  
-00004660: 2020 2020 2020 2020 2020 2020 2020 6669                fi
-00004670: 7273 745f 6974 6572 6174 696f 6e20 3d20  rst_iteration = 
-00004680: 4661 6c73 6520 200d 0a20 2020 2020 2020  False  ..       
-00004690: 2020 2020 2020 2020 200d 0a20 2020 2020           ..     
-000046a0: 2020 2020 2020 2023 2043 616c 6c20 7468         # Call th
-000046b0: 6520 7461 736b 5f65 7661 6c20 6d65 7468  e task_eval meth
-000046c0: 6f64 2077 6974 6820 7468 6520 7573 6572  od with the user
-000046d0: 2773 2071 7565 7374 696f 6e20 6966 2074  's question if t
-000046e0: 6865 2065 7870 6c6f 7261 746f 7279 206d  he exploratory m
-000046f0: 6f64 6520 6973 2054 7275 650d 0a20 2020  ode is True..   
-00004700: 2020 2020 2020 2020 2069 6620 7365 6c66           if self
-00004710: 2e65 7870 6c6f 7261 746f 7279 2069 7320  .exploratory is 
-00004720: 5472 7565 3a0d 0a20 2020 2020 2020 2020  True:..         
-00004730: 2020 2020 2020 2065 7661 6c5f 6d65 7373         eval_mess
-00004740: 6167 6573 2e61 7070 656e 6428 7b22 726f  ages.append({"ro
-00004750: 6c65 223a 2022 7573 6572 222c 2022 636f  le": "user", "co
-00004760: 6e74 656e 7422 3a20 7365 6c66 2e74 6173  ntent": self.tas
-00004770: 6b5f 6576 616c 7561 7469 6f6e 2e66 6f72  k_evaluation.for
-00004780: 6d61 7428 7175 6573 7469 6f6e 2c20 7365  mat(question, se
-00004790: 6c66 2e64 665f 6865 6164 297d 290d 0a20  lf.df_head)}).. 
-000047a0: 2020 2020 2020 2020 2020 2020 2020 2061                 a
-000047b0: 7267 756d 656e 7473 2c20 666e 5f6e 616d  rguments, fn_nam
-000047c0: 652c 2074 6173 6b5f 6576 616c 2c20 7461  e, task_eval, ta
-000047d0: 736b 5f74 7970 6520 3d20 7365 6c66 2e74  sk_type = self.t
-000047e0: 6173 6b5f 6576 616c 2865 7661 6c5f 6d65  ask_eval(eval_me
-000047f0: 7373 6167 6573 290d 0a20 2020 2020 2020  ssages)..       
-00004800: 2020 2020 2020 2020 2065 7661 6c5f 6d65           eval_me
-00004810: 7373 6167 6573 2e61 7070 656e 6428 0d0a  ssages.append(..
-00004820: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004830: 2020 2020 7b0d 0a20 2020 2020 2020 2020      {..         
-00004840: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-00004850: 726f 6c65 223a 2022 6173 7369 7374 616e  role": "assistan
-00004860: 7422 2c0d 0a20 2020 2020 2020 2020 2020  t",..           
-00004870: 2020 2020 2020 2020 2020 2020 2022 636f               "co
-00004880: 6e74 656e 7422 3a20 4e6f 6e65 2c0d 0a20  ntent": None,.. 
-00004890: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000048a0: 2020 2020 2020 2022 6675 6e63 7469 6f6e         "function
-000048b0: 5f63 616c 6c22 3a20 7b0d 0a20 2020 2020  _call": {..     
-000048c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000048d0: 2020 2020 2020 2022 6e61 6d65 223a 2066         "name": f
-000048e0: 6e5f 6e61 6d65 2c0d 0a20 2020 2020 2020  n_name,..       
-000048f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004900: 2020 2020 2022 6172 6775 6d65 6e74 7322       "arguments"
-00004910: 3a20 6172 6775 6d65 6e74 732c 0d0a 2020  : arguments,..  
-00004920: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004930: 2020 2020 2020 7d2c 0d0a 2020 2020 2020        },..      
-00004940: 2020 2020 2020 2020 2020 2020 2020 7d0d                }.
-00004950: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00004960: 2029 0d0a 0d0a 2020 2020 2020 2020 2020   )....          
-00004970: 2020 2020 2020 2320 5265 6d6f 7665 2074        # Remove t
-00004980: 6865 206f 6c64 6573 7420 636f 6e76 6572  he oldest conver
-00004990: 7361 7469 6f6e 2066 726f 6d20 7468 6520  sation from the 
-000049a0: 6d65 7373 6167 6573 206c 6973 740d 0a20  messages list.. 
-000049b0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-000049c0: 6620 6c65 6e28 6576 616c 5f6d 6573 7361  f len(eval_messa
-000049d0: 6765 7329 203e 2073 656c 662e 4d41 585f  ges) > self.MAX_
-000049e0: 434f 4e56 4552 5341 5449 4f4e 533a 0d0a  CONVERSATIONS:..
-000049f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004a00: 2020 2020 6576 616c 5f6d 6573 7361 6765      eval_message
-00004a10: 732e 706f 7028 3129 0d0a 2020 2020 2020  s.pop(1)..      
-00004a20: 2020 2020 2020 2020 2020 2020 2020 6576                ev
-00004a30: 616c 5f6d 6573 7361 6765 732e 706f 7028  al_messages.pop(
-00004a40: 3129 0d0a 0d0a 2020 2020 2020 2020 2020  1)....          
-00004a50: 2020 2020 2020 746f 7461 6c5f 746f 6b65        total_toke
-00004a60: 6e73 5f75 7365 645f 7375 6d20 3d20 7375  ns_used_sum = su
-00004a70: 6d28 7365 6c66 2e74 6f74 616c 5f74 6f6b  m(self.total_tok
-00004a80: 656e 735f 7573 6564 290d 0a0d 0a20 2020  ens_used)....   
-00004a90: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00004aa0: 7461 736b 5f74 7970 6520 3d3d 2027 6e61  task_type == 'na
-00004ab0: 7475 7261 6c5f 6c61 6e67 7561 6765 273a  tural_language':
-00004ac0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00004ad0: 2020 2020 2020 7469 746c 6520 3d20 2748        title = 'H
-00004ae0: 6572 6520 6973 2061 6e20 616e 7377 6572  ere is an answer
-00004af0: 2074 6f20 796f 7572 2071 7565 7374 696f   to your questio
-00004b00: 6e3a 2720 2020 2020 2020 2020 2020 2020  n:'             
-00004b10: 2020 2020 2020 0d0a 2020 2020 2020 2020        ..        
-00004b20: 2020 2020 2020 2020 2020 2020 6469 7370              disp
-00004b30: 6c61 795f 6576 616c 2874 6173 6b5f 6576  lay_eval(task_ev
-00004b40: 616c 2c20 7469 746c 652c 2074 6f74 616c  al, title, total
-00004b50: 5f74 6f6b 656e 735f 7573 6564 5f73 756d  _tokens_used_sum
-00004b60: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
-00004b70: 2020 2020 2020 2063 6f6e 7469 6e75 650d         continue.
-00004b80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00004b90: 2065 6c73 653a 0d0a 2020 2020 2020 2020   else:..        
-00004ba0: 2020 2020 2020 2020 2020 2020 7469 746c              titl
-00004bb0: 6520 3d20 2748 6572 6520 6973 2061 2073  e = 'Here is a s
-00004bc0: 6571 7565 6e63 6520 6f66 2073 7465 7073  equence of steps
-00004bd0: 2072 6571 7569 7265 6420 746f 2063 6f6d   required to com
-00004be0: 706c 6574 6520 7468 6520 7461 736b 3a27  plete the task:'
-00004bf0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00004c00: 2020 2020 2020 7461 736b 203d 2074 6173        task = tas
-00004c10: 6b5f 6576 616c 0d0a 2020 2020 2020 2020  k_eval..        
-00004c20: 2020 2020 2020 2020 2020 2020 6469 7370              disp
-00004c30: 6c61 795f 6576 616c 2874 6173 6b5f 6576  lay_eval(task_ev
-00004c40: 616c 2c20 7469 746c 652c 2074 6f74 616c  al, title, total
-00004c50: 5f74 6f6b 656e 735f 7573 6564 5f73 756d  _tokens_used_sum
-00004c60: 290d 0a20 2020 2020 2020 2020 2020 2065  )..            e
-00004c70: 6c73 653a 0d0a 2020 2020 2020 2020 2020  lse:..          
-00004c80: 2020 2020 2020 7461 736b 203d 2071 7565        task = que
-00004c90: 7374 696f 6e0d 0a0d 0a20 2020 2020 2020  stion....       
-00004ca0: 2020 2020 2023 2043 616c 6c20 7468 6520       # Call the 
-00004cb0: 7064 5f61 6765 6e74 206d 6574 686f 6420  pd_agent method 
-00004cc0: 7769 7468 2074 6865 2075 7365 7227 7320  with the user's 
-00004cd0: 7175 6573 7469 6f6e 2c20 7468 6520 6d65  question, the me
-00004ce0: 7373 6167 6573 206c 6973 742c 2061 6e64  ssages list, and
-00004cf0: 2074 6865 2064 6174 6166 7261 6d65 0d0a   the dataframe..
-00004d00: 2020 2020 2020 2020 2020 2020 616e 7377              answ
-00004d10: 6572 2c20 636f 6465 2c20 746f 7461 6c5f  er, code, total_
-00004d20: 746f 6b65 6e73 5f75 7365 645f 7375 6d20  tokens_used_sum 
-00004d30: 3d20 7365 6c66 2e70 645f 6167 656e 7428  = self.pd_agent(
-00004d40: 7461 736b 2c20 6d65 7373 6167 6573 2c20  task, messages, 
-00004d50: 7365 6c66 2e64 6629 0d0a 0d0a 2020 2020  self.df)....    
-00004d60: 2020 2020 2020 2020 2320 5261 6e6b 2074          # Rank t
-00004d70: 6865 204c 4c4d 2072 6573 706f 6e73 650d  he LLM response.
-00004d80: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00004d90: 7365 6c66 2e72 616e 6b3a 0d0a 2020 2020  self.rank:..    
-00004da0: 2020 2020 2020 2020 2020 2020 2320 5377              # Sw
-00004db0: 6974 6368 2074 6f20 6770 742d 3420 6966  itch to gpt-4 if
-00004dc0: 206c 6c6d 5f73 7769 7463 6820 7061 7261   llm_switch para
-00004dd0: 6d65 7465 7220 6973 2073 6574 2074 6f20  meter is set to 
-00004de0: 5472 7565 2e20 5468 6973 2077 696c 6c20  True. This will 
-00004df0: 696e 6372 6561 7365 2074 6865 2070 726f  increase the pro
-00004e00: 6365 7373 696e 6720 7469 6d65 2061 6e64  cessing time and
-00004e10: 2063 6f73 740d 0a20 2020 2020 2020 2020   cost..         
-00004e20: 2020 2020 2020 2069 6620 7365 6c66 2e6c         if self.l
-00004e30: 6c6d 5f73 7769 7463 683a 0d0a 2020 2020  lm_switch:..    
-00004e40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004e50: 6c6c 6d5f 6361 7363 6164 6520 3d20 5472  llm_cascade = Tr
-00004e60: 7565 0d0a 2020 2020 2020 2020 2020 2020  ue..            
-00004e70: 2020 2020 7261 6e6b 203d 2073 656c 662e      rank = self.
-00004e80: 7261 6e6b 5f63 6f64 6528 636f 6465 2c74  rank_code(code,t
-00004e90: 6173 6b2c 6c6c 6d5f 6361 7363 6164 653d  ask,llm_cascade=
-00004ea0: 6c6c 6d5f 6361 7363 6164 6529 0d0a 2020  llm_cascade)..  
-00004eb0: 2020 2020 2020 2020 2020 656c 7365 3a0d            else:.
-00004ec0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00004ed0: 2072 616e 6b20 3d20 2222 0d0a 0d0a 2020   rank = ""....  
-00004ee0: 2020 2020 2020 2020 2020 6469 7370 6c61            displa
-00004ef0: 795f 7265 7375 6c74 7328 616e 7377 6572  y_results(answer
-00004f00: 2c20 636f 6465 2c20 7261 6e6b 2c20 746f  , code, rank, to
-00004f10: 7461 6c5f 746f 6b65 6e73 5f75 7365 645f  tal_tokens_used_
-00004f20: 7375 6d29 0d0a 0d0a 0d0a 2020 2020 6465  sum)......    de
-00004f30: 6620 7064 5f61 6765 6e74 2873 656c 662c  f pd_agent(self,
-00004f40: 2071 7565 7374 696f 6e2c 206d 6573 7361   question, messa
-00004f50: 6765 732c 2064 663d 4e6f 6e65 293a 0d0a  ges, df=None):..
-00004f60: 2020 2020 2020 2020 2320 4164 6420 6120          # Add a 
-00004f70: 7573 6572 206d 6573 7361 6765 2077 6974  user message wit
-00004f80: 6820 7468 6520 7570 6461 7465 6420 7461  h the updated ta
-00004f90: 736b 2070 726f 6d70 7420 746f 2074 6865  sk prompt to the
-00004fa0: 206d 6573 7361 6765 7320 6c69 7374 0d0a   messages list..
-00004fb0: 2020 2020 2020 2020 6d65 7373 6167 6573          messages
-00004fc0: 2e61 7070 656e 6428 7b22 726f 6c65 223a  .append({"role":
-00004fd0: 2022 7573 6572 222c 2022 636f 6e74 656e   "user", "conten
-00004fe0: 7422 3a20 7365 6c66 2e74 6173 6b2e 666f  t": self.task.fo
-00004ff0: 726d 6174 2873 656c 662e 6466 5f68 6561  rmat(self.df_hea
-00005000: 642c 2071 7565 7374 696f 6e29 7d29 0d0a  d, question)})..
-00005010: 0d0a 2020 2020 2020 2020 6966 2027 6970  ..        if 'ip
-00005020: 796b 6572 6e65 6c27 2069 6e20 7379 732e  ykernel' in sys.
-00005030: 6d6f 6475 6c65 733a 0d0a 2020 2020 2020  modules:..      
-00005040: 2020 2020 2020 2320 4a75 7079 7465 7220        # Jupyter 
-00005050: 6e6f 7465 626f 6f6b 206f 7220 6970 7974  notebook or ipyt
-00005060: 686f 6e0d 0a20 2020 2020 2020 2020 2020  hon..           
-00005070: 2064 6973 706c 6179 2848 544d 4c28 6627   display(HTML(f'
-00005080: 3c70 2073 7479 6c65 3d22 636f 6c6f 723a  <p style="color:
-00005090: 6d61 6765 6e74 613b 223e 5c6e 4361 6c6c  magenta;">\nCall
-000050a0: 696e 6720 4d6f 6465 6c3a 207b 7365 6c66  ing Model: {self
-000050b0: 2e6c 6c6d 7d3c 2f70 3e27 2929 0d0a 2020  .llm}</p>'))..  
-000050c0: 2020 2020 2020 2020 2020 6469 7370 6c61            displa
-000050d0: 7928 4854 4d4c 2866 273c 703e 3c62 2073  y(HTML(f'<p><b s
-000050e0: 7479 6c65 3d22 636f 6c6f 723a 6d61 6765  tyle="color:mage
-000050f0: 6e74 613b 223e 4920 6861 7665 2073 656e  nta;">I have sen
-00005100: 7420 796f 7572 2072 6571 7565 7374 2074  t your request t
-00005110: 6f20 7468 6520 4c4c 4d20 616e 6420 6177  o the LLM and aw
-00005120: 6169 7469 6e67 2072 6573 706f 6e73 652c  aiting response,
-00005130: 2070 6c65 6173 6520 7761 6974 2e2e 2e3c   please wait...<
-00005140: 2f62 3e3c 2f70 3e3c 6272 3e27 2929 0d0a  /b></p><br>'))..
-00005150: 2020 2020 2020 2020 656c 7365 3a0d 0a20          else:.. 
-00005160: 2020 2020 2020 2020 2020 2023 204f 7468             # Oth
-00005170: 6572 2065 6e76 6972 6f6e 6d65 6e74 2028  er environment (
-00005180: 6c69 6b65 2074 6572 6d69 6e61 6c29 0d0a  like terminal)..
-00005190: 2020 2020 2020 2020 2020 2020 7072 696e              prin
-000051a0: 7428 636f 6c6f 7265 6428 6622 5c6e 3e3e  t(colored(f"\n>>
-000051b0: 2043 616c 6c69 6e67 204d 6f64 656c 3a20   Calling Model: 
-000051c0: 7b73 656c 662e 6c6c 6d7d 222c 2022 6d61  {self.llm}", "ma
-000051d0: 6765 6e74 6122 2929 0d0a 2020 2020 2020  genta"))..      
-000051e0: 2020 2020 2020 6370 7269 6e74 2866 225c        cprint(f"\
-000051f0: 6e3e 3e20 4920 6861 7665 2073 656e 7420  n>> I have sent 
-00005200: 796f 7572 2072 6571 7565 7374 2074 6f20  your request to 
-00005210: 7468 6520 4c4c 4d20 616e 6420 6177 6169  the LLM and awai
-00005220: 7469 6e67 2072 6573 706f 6e73 652c 2070  ting response, p
-00005230: 6c65 6173 6520 7761 6974 2e2e 2e5c 6e22  lease wait...\n"
-00005240: 2c20 276d 6167 656e 7461 272c 2061 7474  , 'magenta', att
-00005250: 7273 3d5b 2762 6f6c 6427 5d29 0d0a 0d0a  rs=['bold'])....
-00005260: 2020 2020 2020 2020 2320 4361 6c6c 2074          # Call t
-00005270: 6865 204f 7065 6e41 4920 4150 490d 0a20  he OpenAI API.. 
-00005280: 2020 2020 2020 206c 6c6d 5f72 6573 706f         llm_respo
-00005290: 6e73 652c 2074 6f6b 656e 735f 7573 6564  nse, tokens_used
-000052a0: 203d 2073 656c 662e 6c6c 6d5f 6361 6c6c   = self.llm_call
-000052b0: 286d 6573 7361 6765 7329 0d0a 0d0a 2020  (messages)....  
-000052c0: 2020 2020 2020 2320 4578 7472 6163 7420        # Extract 
-000052d0: 7468 6520 636f 6465 2066 726f 6d20 7468  the code from th
-000052e0: 6520 4150 4920 7265 7370 6f6e 7365 0d0a  e API response..
-000052f0: 2020 2020 2020 2020 636f 6465 203d 2073          code = s
-00005300: 656c 662e 5f65 7874 7261 6374 5f63 6f64  elf._extract_cod
-00005310: 6528 6c6c 6d5f 7265 7370 6f6e 7365 290d  e(llm_response).
-00005320: 0a0d 0a20 2020 2020 2020 2023 2055 7064  ...        # Upd
-00005330: 6174 6520 7468 6520 746f 7461 6c20 746f  ate the total to
-00005340: 6b65 6e73 2075 7365 640d 0a20 2020 2020  kens used..     
-00005350: 2020 2073 656c 662e 746f 7461 6c5f 746f     self.total_to
-00005360: 6b65 6e73 5f75 7365 642e 6170 7065 6e64  kens_used.append
-00005370: 2874 6f6b 656e 735f 7573 6564 290d 0a0d  (tokens_used)...
-00005380: 0a20 2020 2020 2020 2023 2049 6e69 7469  .        # Initi
-00005390: 616c 697a 6520 6572 726f 7220 636f 7272  alize error corr
-000053a0: 6563 7469 6f6e 2063 6f75 6e74 6572 0d0a  ection counter..
-000053b0: 2020 2020 2020 2020 6572 726f 725f 636f          error_co
-000053c0: 7272 6563 7469 6f6e 7320 3d20 300d 0a0d  rrections = 0...
-000053d0: 0a20 2020 2020 2020 2023 2044 6562 7567  .        # Debug
-000053e0: 2063 6f64 6520 6966 2064 6562 7567 2070   code if debug p
-000053f0: 6172 616d 6574 6572 2069 7320 7365 7420  arameter is set 
-00005400: 746f 2054 7275 650d 0a20 2020 2020 2020  to True..       
-00005410: 2069 6620 7365 6c66 2e64 6562 7567 3a0d   if self.debug:.
-00005420: 0a20 2020 2020 2020 2020 2020 2023 2053  .            # S
-00005430: 7769 7463 6820 746f 2067 7074 2d34 2069  witch to gpt-4 i
-00005440: 6620 6c6c 6d5f 7377 6974 6368 2070 6172  f llm_switch par
-00005450: 616d 6574 6572 2069 7320 7365 7420 746f  ameter is set to
-00005460: 2054 7275 652e 2054 6869 7320 7769 6c6c   True. This will
-00005470: 2069 6e63 7265 6173 6520 7468 6520 7072   increase the pr
-00005480: 6f63 6573 7369 6e67 2074 696d 6520 616e  ocessing time an
-00005490: 6420 636f 7374 0d0a 2020 2020 2020 2020  d cost..        
-000054a0: 2020 2020 6966 2073 656c 662e 6c6c 6d5f      if self.llm_
-000054b0: 7377 6974 6368 3a0d 0a20 2020 2020 2020  switch:..       
-000054c0: 2020 2020 2020 2020 206c 6c6d 5f63 6173           llm_cas
-000054d0: 6361 6465 203d 2054 7275 650d 0a20 2020  cade = True..   
-000054e0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-000054f0: 2769 7079 6b65 726e 656c 2720 696e 2073  'ipykernel' in s
-00005500: 7973 2e6d 6f64 756c 6573 3a0d 0a20 2020  ys.modules:..   
-00005510: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005520: 2023 204a 7570 7974 6572 206e 6f74 6562   # Jupyter noteb
-00005530: 6f6f 6b0d 0a20 2020 2020 2020 2020 2020  ook..           
-00005540: 2020 2020 2020 2020 2064 6973 706c 6179           display
-00005550: 2848 544d 4c28 273c 7370 616e 2073 7479  (HTML('<span sty
-00005560: 6c65 3d22 636f 6c6f 723a 206d 6167 656e  le="color: magen
-00005570: 7461 3b22 3e53 7769 7463 6869 6e67 206d  ta;">Switching m
-00005580: 6f64 656c 2074 6f20 6770 742d 3420 746f  odel to gpt-4 to
-00005590: 2064 6562 7567 2074 6865 2063 6f64 652e   debug the code.
-000055a0: 3c2f 7370 616e 3e27 2929 0d0a 2020 2020  </span>'))..    
-000055b0: 2020 2020 2020 2020 2020 2020 656c 7365              else
-000055c0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-000055d0: 2020 2020 2020 2023 2043 4c49 0d0a 2020         # CLI..  
-000055e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000055f0: 2020 7072 696e 7428 636f 6c6f 7265 6428    print(colored(
-00005600: 225c 6e3e 3e20 5377 6974 6368 696e 6720  "\n>> Switching 
-00005610: 6d6f 6465 6c20 746f 2047 5054 2d34 2074  model to GPT-4 t
-00005620: 6f20 6465 6275 6720 7468 6520 636f 6465  o debug the code
-00005630: 2e22 2c20 226d 6167 656e 7461 2229 290d  .", "magenta")).
-00005640: 0a20 2020 2020 2020 2020 2020 2063 6f64  .            cod
-00005650: 6520 3d20 7365 6c66 2e64 6562 7567 5f63  e = self.debug_c
-00005660: 6f64 6528 636f 6465 2c20 7175 6573 7469  ode(code, questi
-00005670: 6f6e 2c20 6c6c 6d5f 6361 7363 6164 653d  on, llm_cascade=
-00005680: 6c6c 6d5f 6361 7363 6164 6529 0d0a 0d0a  llm_cascade)....
-00005690: 2020 2020 2020 2020 2320 5265 6469 7265          # Redire
-000056a0: 6374 2073 7461 6e64 6172 6420 6f75 7470  ct standard outp
-000056b0: 7574 2074 6f20 6120 5374 7269 6e67 494f  ut to a StringIO
-000056c0: 2062 7566 6665 720d 0a20 2020 2020 2020   buffer..       
-000056d0: 2077 6974 6820 7265 6469 7265 6374 5f73   with redirect_s
-000056e0: 7464 6f75 7428 696f 2e53 7472 696e 6749  tdout(io.StringI
-000056f0: 4f28 2929 2061 7320 6f75 7470 7574 3a0d  O()) as output:.
-00005700: 0a20 2020 2020 2020 2020 2020 2023 2054  .            # T
-00005710: 7279 2074 6f20 6578 6563 7574 6520 7468  ry to execute th
-00005720: 6520 636f 6465 2061 6e64 2068 616e 646c  e code and handl
-00005730: 6520 6572 726f 7273 0d0a 2020 2020 2020  e errors..      
-00005740: 2020 2020 2020 7768 696c 6520 6572 726f        while erro
-00005750: 725f 636f 7272 6563 7469 6f6e 7320 3c20  r_corrections < 
-00005760: 7365 6c66 2e4d 4158 5f45 5252 4f52 5f43  self.MAX_ERROR_C
-00005770: 4f52 5245 4354 494f 4e53 3a0d 0a20 2020  ORRECTIONS:..   
-00005780: 2020 2020 2020 2020 2020 2020 2074 7279               try
-00005790: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-000057a0: 2020 2020 2020 206d 6573 7361 6765 732e         messages.
-000057b0: 6170 7065 6e64 287b 2272 6f6c 6522 3a20  append({"role": 
-000057c0: 2261 7373 6973 7461 6e74 222c 2022 636f  "assistant", "co
-000057d0: 6e74 656e 7422 3a20 6c6c 6d5f 7265 7370  ntent": llm_resp
-000057e0: 6f6e 7365 7d29 0d0a 2020 2020 2020 2020  onse})..        
-000057f0: 2020 2020 2020 2020 2020 2020 2320 5265              # Re
-00005800: 6d6f 7665 2074 6865 206f 6c64 6573 7420  move the oldest 
-00005810: 636f 6e76 6572 7361 7469 6f6e 2066 726f  conversation fro
-00005820: 6d20 7468 6520 6d65 7373 6167 6573 206c  m the messages l
-00005830: 6973 740d 0a20 2020 2020 2020 2020 2020  ist..           
-00005840: 2020 2020 2020 2020 2069 6620 6c65 6e28           if len(
-00005850: 6d65 7373 6167 6573 2920 3e20 7365 6c66  messages) > self
-00005860: 2e4d 4158 5f43 4f4e 5645 5253 4154 494f  .MAX_CONVERSATIO
-00005870: 4e53 3a0d 0a20 2020 2020 2020 2020 2020  NS:..           
-00005880: 2020 2020 2020 2020 2020 2020 206d 6573               mes
-00005890: 7361 6765 732e 706f 7028 3129 0d0a 2020  sages.pop(1)..  
+00004160: 2065 6c73 653a 0d0a 2020 2020 2020 2020   else:..        
+00004170: 2020 2020 2020 2020 2020 2020 6c6c 6d5f              llm_
+00004180: 6361 7363 6164 6520 3d20 4661 6c73 650d  cascade = False.
+00004190: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000041a0: 2072 616e 6b20 3d20 7365 6c66 2e72 616e   rank = self.ran
+000041b0: 6b5f 636f 6465 2863 6f64 652c 7461 736b  k_code(code,task
+000041c0: 2c6c 6c6d 5f63 6173 6361 6465 3d6c 6c6d  ,llm_cascade=llm
+000041d0: 5f63 6173 6361 6465 290d 0a20 2020 2020  _cascade)..     
+000041e0: 2020 2020 2020 2065 6c73 653a 0d0a 2020         else:..  
+000041f0: 2020 2020 2020 2020 2020 2020 2020 7261                ra
+00004200: 6e6b 203d 2022 220d 0a0d 0a20 2020 2020  nk = ""....     
+00004210: 2020 2020 2020 2064 6973 706c 6179 5f72         display_r
+00004220: 6573 756c 7473 2861 6e73 7765 722c 2063  esults(answer, c
+00004230: 6f64 652c 2072 616e 6b2c 2074 6f74 616c  ode, rank, total
+00004240: 5f74 6f6b 656e 735f 7573 6564 5f73 756d  _tokens_used_sum
+00004250: 290d 0a20 2020 2020 2020 2020 2020 2072  )..            r
+00004260: 6574 7572 6e0d 0a20 2020 2020 2020 200d  eturn..        .
+00004270: 0a20 2020 2020 2020 2023 2053 7461 7274  .        # Start
+00004280: 2061 6e20 696e 6669 6e69 7465 206c 6f6f   an infinite loo
+00004290: 7020 746f 206b 6565 7020 6173 6b69 6e67  p to keep asking
+000042a0: 2074 6865 2075 7365 7220 666f 7220 7175   the user for qu
+000042b0: 6573 7469 6f6e 730d 0a20 2020 2020 2020  estions..       
+000042c0: 2066 6972 7374 5f69 7465 7261 7469 6f6e   first_iteration
+000042d0: 203d 2054 7275 6520 2023 2046 6c61 6720   = True  # Flag 
+000042e0: 666f 7220 7468 6520 6669 7273 7420 6974  for the first it
+000042f0: 6572 6174 696f 6e20 6f66 2074 6865 206c  eration of the l
+00004300: 6f6f 700d 0a20 2020 2020 2020 2077 6869  oop..        whi
+00004310: 6c65 2054 7275 653a 0d0a 2020 2020 2020  le True:..      
+00004320: 2020 2020 2020 2320 5072 6f6d 7074 2074        # Prompt t
+00004330: 6865 2075 7365 7220 746f 2065 6e74 6572  he user to enter
+00004340: 2061 2071 7565 7374 696f 6e20 6f72 2074   a question or t
+00004350: 7970 6520 2765 7869 7427 2074 6f20 7175  ype 'exit' to qu
+00004360: 6974 0d0a 2020 2020 2020 2020 2020 2020  it..            
+00004370: 6966 2027 6970 796b 6572 6e65 6c27 2069  if 'ipykernel' i
+00004380: 6e20 7379 732e 6d6f 6475 6c65 733a 0d0a  n sys.modules:..
+00004390: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000043a0: 6469 7370 6c61 7928 4854 4d4c 2827 3c62  display(HTML('<b
+000043b0: 2073 7479 6c65 3d22 636f 6c6f 723a 626c   style="color:bl
+000043c0: 7565 3b22 3e45 6e74 6572 2079 6f75 7220  ue;">Enter your 
+000043d0: 7175 6573 7469 6f6e 206f 7220 7479 7065  question or type
+000043e0: 205c 2765 7869 745c 2720 746f 2071 7569   \'exit\' to qui
+000043f0: 743a 3c2f 623e 2729 290d 0a20 2020 2020  t:</b>'))..     
+00004400: 2020 2020 2020 2020 2020 2074 696d 652e             time.
+00004410: 736c 6565 7028 3129 0d0a 2020 2020 2020  sleep(1)..      
+00004420: 2020 2020 2020 2020 2020 7175 6573 7469            questi
+00004430: 6f6e 203d 2069 6e70 7574 2829 0d0a 2020  on = input()..  
+00004440: 2020 2020 2020 2020 2020 656c 7365 3a0d            else:.
+00004450: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00004460: 2063 7072 696e 7428 225c 6e45 6e74 6572   cprint("\nEnter
+00004470: 2079 6f75 7220 7175 6573 7469 6f6e 206f   your question o
+00004480: 7220 7479 7065 2027 6578 6974 2720 746f  r type 'exit' to
+00004490: 2071 7569 743a 222c 2027 626c 7565 272c   quit:", 'blue',
+000044a0: 2061 7474 7273 3d5b 2762 6f6c 6427 5d29   attrs=['bold'])
+000044b0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000044c0: 2020 7175 6573 7469 6f6e 203d 2069 6e70    question = inp
+000044d0: 7574 2829 0d0a 0d0a 2020 2020 2020 2020  ut()....        
+000044e0: 2020 2020 2320 4966 2074 6865 2075 7365      # If the use
+000044f0: 7220 7479 7065 7320 2765 7869 7427 2c20  r types 'exit', 
+00004500: 6272 6561 6b20 6f75 7420 6f66 2074 6865  break out of the
+00004510: 206c 6f6f 700d 0a20 2020 2020 2020 2020   loop..         
+00004520: 2020 2069 6620 7175 6573 7469 6f6e 2e73     if question.s
+00004530: 7472 6970 2829 2e6c 6f77 6572 2829 203d  trip().lower() =
+00004540: 3d20 2765 7869 7427 3a0d 0a20 2020 2020  = 'exit':..     
+00004550: 2020 2020 2020 2020 2020 2062 7265 616b             break
+00004560: 0d0a 0d0a 2020 2020 2020 2020 2020 2020  ....            
+00004570: 6966 2066 6972 7374 5f69 7465 7261 7469  if first_iterati
+00004580: 6f6e 3a0d 0a20 2020 2020 2020 2020 2020  on:..           
+00004590: 2020 2020 2023 2049 6e69 7469 616c 697a       # Initializ
+000045a0: 6520 7468 6520 6d65 7373 6167 6573 206c  e the messages l
+000045b0: 6973 7420 7769 7468 2061 2073 7973 7465  ist with a syste
+000045c0: 6d20 6d65 7373 6167 6520 636f 6e74 6169  m message contai
+000045d0: 6e69 6e67 2074 6865 2074 6173 6b20 7072  ning the task pr
+000045e0: 6f6d 7074 0d0a 2020 2020 2020 2020 2020  ompt..          
+000045f0: 2020 2020 2020 6d65 7373 6167 6573 203d        messages =
+00004600: 205b 7b22 726f 6c65 223a 2022 7379 7374   [{"role": "syst
+00004610: 656d 222c 2022 636f 6e74 656e 7422 3a20  em", "content": 
+00004620: 7365 6c66 2e73 7973 7465 6d5f 7461 736b  self.system_task
+00004630: 2e66 6f72 6d61 7428 7175 6573 7469 6f6e  .format(question
+00004640: 297d 5d0d 0a20 2020 2020 2020 2020 2020  )}]..           
+00004650: 2020 2020 2023 2049 6e69 7469 616c 697a       # Initializ
+00004660: 6520 7468 6520 6576 616c 5f6d 6573 7361  e the eval_messa
+00004670: 6765 7320 6c69 7374 0d0a 2020 2020 2020  ges list..      
+00004680: 2020 2020 2020 2020 2020 6576 616c 5f6d            eval_m
+00004690: 6573 7361 6765 7320 3d20 5b5d 0d0a 2020  essages = []..  
+000046a0: 2020 2020 2020 2020 2020 2020 2020 6669                fi
+000046b0: 7273 745f 6974 6572 6174 696f 6e20 3d20  rst_iteration = 
+000046c0: 4661 6c73 6520 200d 0a20 2020 2020 2020  False  ..       
+000046d0: 2020 2020 2020 2020 200d 0a20 2020 2020           ..     
+000046e0: 2020 2020 2020 2023 2043 616c 6c20 7468         # Call th
+000046f0: 6520 7461 736b 5f65 7661 6c20 6d65 7468  e task_eval meth
+00004700: 6f64 2077 6974 6820 7468 6520 7573 6572  od with the user
+00004710: 2773 2071 7565 7374 696f 6e20 6966 2074  's question if t
+00004720: 6865 2065 7870 6c6f 7261 746f 7279 206d  he exploratory m
+00004730: 6f64 6520 6973 2054 7275 650d 0a20 2020  ode is True..   
+00004740: 2020 2020 2020 2020 2069 6620 7365 6c66           if self
+00004750: 2e65 7870 6c6f 7261 746f 7279 2069 7320  .exploratory is 
+00004760: 5472 7565 3a0d 0a20 2020 2020 2020 2020  True:..         
+00004770: 2020 2020 2020 2065 7661 6c5f 6d65 7373         eval_mess
+00004780: 6167 6573 2e61 7070 656e 6428 7b22 726f  ages.append({"ro
+00004790: 6c65 223a 2022 7573 6572 222c 2022 636f  le": "user", "co
+000047a0: 6e74 656e 7422 3a20 7365 6c66 2e74 6173  ntent": self.tas
+000047b0: 6b5f 6576 616c 7561 7469 6f6e 2e66 6f72  k_evaluation.for
+000047c0: 6d61 7428 7175 6573 7469 6f6e 2c20 7365  mat(question, se
+000047d0: 6c66 2e64 665f 6865 6164 297d 290d 0a20  lf.df_head)}).. 
+000047e0: 2020 2020 2020 2020 2020 2020 2020 2061                 a
+000047f0: 7267 756d 656e 7473 2c20 666e 5f6e 616d  rguments, fn_nam
+00004800: 652c 2074 6173 6b5f 6576 616c 2c20 7461  e, task_eval, ta
+00004810: 736b 5f74 7970 6520 3d20 7365 6c66 2e74  sk_type = self.t
+00004820: 6173 6b5f 6576 616c 2865 7661 6c5f 6d65  ask_eval(eval_me
+00004830: 7373 6167 6573 290d 0a20 2020 2020 2020  ssages)..       
+00004840: 2020 2020 2020 2020 2065 7661 6c5f 6d65           eval_me
+00004850: 7373 6167 6573 2e61 7070 656e 6428 0d0a  ssages.append(..
+00004860: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004870: 2020 2020 7b0d 0a20 2020 2020 2020 2020      {..         
+00004880: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+00004890: 726f 6c65 223a 2022 6173 7369 7374 616e  role": "assistan
+000048a0: 7422 2c0d 0a20 2020 2020 2020 2020 2020  t",..           
+000048b0: 2020 2020 2020 2020 2020 2020 2022 636f               "co
+000048c0: 6e74 656e 7422 3a20 4e6f 6e65 2c0d 0a20  ntent": None,.. 
+000048d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000048e0: 2020 2020 2020 2022 6675 6e63 7469 6f6e         "function
+000048f0: 5f63 616c 6c22 3a20 7b0d 0a20 2020 2020  _call": {..     
+00004900: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004910: 2020 2020 2020 2022 6e61 6d65 223a 2066         "name": f
+00004920: 6e5f 6e61 6d65 2c0d 0a20 2020 2020 2020  n_name,..       
+00004930: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004940: 2020 2020 2022 6172 6775 6d65 6e74 7322       "arguments"
+00004950: 3a20 6172 6775 6d65 6e74 732c 0d0a 2020  : arguments,..  
+00004960: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004970: 2020 2020 2020 7d2c 0d0a 2020 2020 2020        },..      
+00004980: 2020 2020 2020 2020 2020 2020 2020 7d0d                }.
+00004990: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000049a0: 2029 0d0a 0d0a 2020 2020 2020 2020 2020   )....          
+000049b0: 2020 2020 2020 2320 5265 6d6f 7665 2074        # Remove t
+000049c0: 6865 206f 6c64 6573 7420 636f 6e76 6572  he oldest conver
+000049d0: 7361 7469 6f6e 2066 726f 6d20 7468 6520  sation from the 
+000049e0: 6d65 7373 6167 6573 206c 6973 740d 0a20  messages list.. 
+000049f0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00004a00: 6620 6c65 6e28 6576 616c 5f6d 6573 7361  f len(eval_messa
+00004a10: 6765 7329 203e 2073 656c 662e 4d41 585f  ges) > self.MAX_
+00004a20: 434f 4e56 4552 5341 5449 4f4e 533a 0d0a  CONVERSATIONS:..
+00004a30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004a40: 2020 2020 6576 616c 5f6d 6573 7361 6765      eval_message
+00004a50: 732e 706f 7028 3129 0d0a 2020 2020 2020  s.pop(1)..      
+00004a60: 2020 2020 2020 2020 2020 2020 2020 6576                ev
+00004a70: 616c 5f6d 6573 7361 6765 732e 706f 7028  al_messages.pop(
+00004a80: 3129 0d0a 0d0a 2020 2020 2020 2020 2020  1)....          
+00004a90: 2020 2020 2020 746f 7461 6c5f 746f 6b65        total_toke
+00004aa0: 6e73 5f75 7365 645f 7375 6d20 3d20 7375  ns_used_sum = su
+00004ab0: 6d28 7365 6c66 2e74 6f74 616c 5f74 6f6b  m(self.total_tok
+00004ac0: 656e 735f 7573 6564 290d 0a0d 0a20 2020  ens_used)....   
+00004ad0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00004ae0: 7461 736b 5f74 7970 6520 3d3d 2027 6e61  task_type == 'na
+00004af0: 7475 7261 6c5f 6c61 6e67 7561 6765 273a  tural_language':
+00004b00: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00004b10: 2020 2020 2020 7469 746c 6520 3d20 2748        title = 'H
+00004b20: 6572 6520 6973 2061 6e20 616e 7377 6572  ere is an answer
+00004b30: 2074 6f20 796f 7572 2071 7565 7374 696f   to your questio
+00004b40: 6e3a 2720 2020 2020 2020 2020 2020 2020  n:'             
+00004b50: 2020 2020 2020 0d0a 2020 2020 2020 2020        ..        
+00004b60: 2020 2020 2020 2020 2020 2020 6469 7370              disp
+00004b70: 6c61 795f 6576 616c 2874 6173 6b5f 6576  lay_eval(task_ev
+00004b80: 616c 2c20 7469 746c 652c 2074 6f74 616c  al, title, total
+00004b90: 5f74 6f6b 656e 735f 7573 6564 5f73 756d  _tokens_used_sum
+00004ba0: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+00004bb0: 2020 2020 2020 2063 6f6e 7469 6e75 650d         continue.
+00004bc0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00004bd0: 2065 6c73 653a 0d0a 2020 2020 2020 2020   else:..        
+00004be0: 2020 2020 2020 2020 2020 2020 7469 746c              titl
+00004bf0: 6520 3d20 2748 6572 6520 6973 2061 2073  e = 'Here is a s
+00004c00: 6571 7565 6e63 6520 6f66 2073 7465 7073  equence of steps
+00004c10: 2072 6571 7569 7265 6420 746f 2063 6f6d   required to com
+00004c20: 706c 6574 6520 7468 6520 7461 736b 3a27  plete the task:'
+00004c30: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00004c40: 2020 2020 2020 7461 736b 203d 2074 6173        task = tas
+00004c50: 6b5f 6576 616c 0d0a 2020 2020 2020 2020  k_eval..        
+00004c60: 2020 2020 2020 2020 2020 2020 6469 7370              disp
+00004c70: 6c61 795f 6576 616c 2874 6173 6b5f 6576  lay_eval(task_ev
+00004c80: 616c 2c20 7469 746c 652c 2074 6f74 616c  al, title, total
+00004c90: 5f74 6f6b 656e 735f 7573 6564 5f73 756d  _tokens_used_sum
+00004ca0: 290d 0a20 2020 2020 2020 2020 2020 2065  )..            e
+00004cb0: 6c73 653a 0d0a 2020 2020 2020 2020 2020  lse:..          
+00004cc0: 2020 2020 2020 7461 736b 203d 2071 7565        task = que
+00004cd0: 7374 696f 6e0d 0a0d 0a20 2020 2020 2020  stion....       
+00004ce0: 2020 2020 2023 2043 616c 6c20 7468 6520       # Call the 
+00004cf0: 7064 5f61 6765 6e74 206d 6574 686f 6420  pd_agent method 
+00004d00: 7769 7468 2074 6865 2075 7365 7227 7320  with the user's 
+00004d10: 7175 6573 7469 6f6e 2c20 7468 6520 6d65  question, the me
+00004d20: 7373 6167 6573 206c 6973 742c 2061 6e64  ssages list, and
+00004d30: 2074 6865 2064 6174 6166 7261 6d65 0d0a   the dataframe..
+00004d40: 2020 2020 2020 2020 2020 2020 616e 7377              answ
+00004d50: 6572 2c20 636f 6465 2c20 746f 7461 6c5f  er, code, total_
+00004d60: 746f 6b65 6e73 5f75 7365 645f 7375 6d20  tokens_used_sum 
+00004d70: 3d20 7365 6c66 2e70 645f 6167 656e 7428  = self.pd_agent(
+00004d80: 7461 736b 2c20 6d65 7373 6167 6573 2c20  task, messages, 
+00004d90: 7365 6c66 2e64 6629 0d0a 0d0a 2020 2020  self.df)....    
+00004da0: 2020 2020 2020 2020 2320 5261 6e6b 2074          # Rank t
+00004db0: 6865 204c 4c4d 2072 6573 706f 6e73 650d  he LLM response.
+00004dc0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00004dd0: 7365 6c66 2e72 616e 6b3a 0d0a 2020 2020  self.rank:..    
+00004de0: 2020 2020 2020 2020 2020 2020 2320 5377              # Sw
+00004df0: 6974 6368 2074 6f20 6770 742d 3420 6966  itch to gpt-4 if
+00004e00: 206c 6c6d 5f73 7769 7463 6820 7061 7261   llm_switch para
+00004e10: 6d65 7465 7220 6973 2073 6574 2074 6f20  meter is set to 
+00004e20: 5472 7565 2e20 5468 6973 2077 696c 6c20  True. This will 
+00004e30: 696e 6372 6561 7365 2074 6865 2070 726f  increase the pro
+00004e40: 6365 7373 696e 6720 7469 6d65 2061 6e64  cessing time and
+00004e50: 2063 6f73 740d 0a20 2020 2020 2020 2020   cost..         
+00004e60: 2020 2020 2020 2069 6620 7365 6c66 2e6c         if self.l
+00004e70: 6c6d 5f73 7769 7463 683a 0d0a 2020 2020  lm_switch:..    
+00004e80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004e90: 6c6c 6d5f 6361 7363 6164 6520 3d20 5472  llm_cascade = Tr
+00004ea0: 7565 0d0a 2020 2020 2020 2020 2020 2020  ue..            
+00004eb0: 2020 2020 656c 7365 3a0d 0a20 2020 2020      else:..     
+00004ec0: 2020 2020 2020 2020 2020 2020 2020 206c                 l
+00004ed0: 6c6d 5f63 6173 6361 6465 203d 2046 616c  lm_cascade = Fal
+00004ee0: 7365 0d0a 2020 2020 2020 2020 2020 2020  se..            
+00004ef0: 2020 2020 7261 6e6b 203d 2073 656c 662e      rank = self.
+00004f00: 7261 6e6b 5f63 6f64 6528 636f 6465 2c74  rank_code(code,t
+00004f10: 6173 6b2c 6c6c 6d5f 6361 7363 6164 653d  ask,llm_cascade=
+00004f20: 6c6c 6d5f 6361 7363 6164 6529 0d0a 2020  llm_cascade)..  
+00004f30: 2020 2020 2020 2020 2020 656c 7365 3a0d            else:.
+00004f40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00004f50: 2072 616e 6b20 3d20 2222 0d0a 0d0a 2020   rank = ""....  
+00004f60: 2020 2020 2020 2020 2020 6469 7370 6c61            displa
+00004f70: 795f 7265 7375 6c74 7328 616e 7377 6572  y_results(answer
+00004f80: 2c20 636f 6465 2c20 7261 6e6b 2c20 746f  , code, rank, to
+00004f90: 7461 6c5f 746f 6b65 6e73 5f75 7365 645f  tal_tokens_used_
+00004fa0: 7375 6d29 0d0a 0d0a 0d0a 2020 2020 6465  sum)......    de
+00004fb0: 6620 7064 5f61 6765 6e74 2873 656c 662c  f pd_agent(self,
+00004fc0: 2071 7565 7374 696f 6e2c 206d 6573 7361   question, messa
+00004fd0: 6765 732c 2064 663d 4e6f 6e65 293a 0d0a  ges, df=None):..
+00004fe0: 2020 2020 2020 2020 2320 4164 6420 6120          # Add a 
+00004ff0: 7573 6572 206d 6573 7361 6765 2077 6974  user message wit
+00005000: 6820 7468 6520 7570 6461 7465 6420 7461  h the updated ta
+00005010: 736b 2070 726f 6d70 7420 746f 2074 6865  sk prompt to the
+00005020: 206d 6573 7361 6765 7320 6c69 7374 0d0a   messages list..
+00005030: 2020 2020 2020 2020 6d65 7373 6167 6573          messages
+00005040: 2e61 7070 656e 6428 7b22 726f 6c65 223a  .append({"role":
+00005050: 2022 7573 6572 222c 2022 636f 6e74 656e   "user", "conten
+00005060: 7422 3a20 7365 6c66 2e74 6173 6b2e 666f  t": self.task.fo
+00005070: 726d 6174 2873 656c 662e 6466 5f68 6561  rmat(self.df_hea
+00005080: 642c 2071 7565 7374 696f 6e29 7d29 0d0a  d, question)})..
+00005090: 0d0a 2020 2020 2020 2020 6966 2027 6970  ..        if 'ip
+000050a0: 796b 6572 6e65 6c27 2069 6e20 7379 732e  ykernel' in sys.
+000050b0: 6d6f 6475 6c65 733a 0d0a 2020 2020 2020  modules:..      
+000050c0: 2020 2020 2020 2320 4a75 7079 7465 7220        # Jupyter 
+000050d0: 6e6f 7465 626f 6f6b 206f 7220 6970 7974  notebook or ipyt
+000050e0: 686f 6e0d 0a20 2020 2020 2020 2020 2020  hon..           
+000050f0: 2064 6973 706c 6179 2848 544d 4c28 6627   display(HTML(f'
+00005100: 3c70 2073 7479 6c65 3d22 636f 6c6f 723a  <p style="color:
+00005110: 6d61 6765 6e74 613b 223e 5c6e 4361 6c6c  magenta;">\nCall
+00005120: 696e 6720 4d6f 6465 6c3a 207b 7365 6c66  ing Model: {self
+00005130: 2e6c 6c6d 7d3c 2f70 3e27 2929 0d0a 2020  .llm}</p>'))..  
+00005140: 2020 2020 2020 2020 2020 6469 7370 6c61            displa
+00005150: 7928 4854 4d4c 2866 273c 703e 3c62 2073  y(HTML(f'<p><b s
+00005160: 7479 6c65 3d22 636f 6c6f 723a 6d61 6765  tyle="color:mage
+00005170: 6e74 613b 223e 4920 6861 7665 2073 656e  nta;">I have sen
+00005180: 7420 796f 7572 2072 6571 7565 7374 2074  t your request t
+00005190: 6f20 7468 6520 4c4c 4d20 616e 6420 6177  o the LLM and aw
+000051a0: 6169 7469 6e67 2072 6573 706f 6e73 652c  aiting response,
+000051b0: 2070 6c65 6173 6520 7761 6974 2e2e 2e3c   please wait...<
+000051c0: 2f62 3e3c 2f70 3e3c 6272 3e27 2929 0d0a  /b></p><br>'))..
+000051d0: 2020 2020 2020 2020 656c 7365 3a0d 0a20          else:.. 
+000051e0: 2020 2020 2020 2020 2020 2023 204f 7468             # Oth
+000051f0: 6572 2065 6e76 6972 6f6e 6d65 6e74 2028  er environment (
+00005200: 6c69 6b65 2074 6572 6d69 6e61 6c29 0d0a  like terminal)..
+00005210: 2020 2020 2020 2020 2020 2020 7072 696e              prin
+00005220: 7428 636f 6c6f 7265 6428 6622 5c6e 3e3e  t(colored(f"\n>>
+00005230: 2043 616c 6c69 6e67 204d 6f64 656c 3a20   Calling Model: 
+00005240: 7b73 656c 662e 6c6c 6d7d 222c 2022 6d61  {self.llm}", "ma
+00005250: 6765 6e74 6122 2929 0d0a 2020 2020 2020  genta"))..      
+00005260: 2020 2020 2020 6370 7269 6e74 2866 225c        cprint(f"\
+00005270: 6e3e 3e20 4920 6861 7665 2073 656e 7420  n>> I have sent 
+00005280: 796f 7572 2072 6571 7565 7374 2074 6f20  your request to 
+00005290: 7468 6520 4c4c 4d20 616e 6420 6177 6169  the LLM and awai
+000052a0: 7469 6e67 2072 6573 706f 6e73 652c 2070  ting response, p
+000052b0: 6c65 6173 6520 7761 6974 2e2e 2e5c 6e22  lease wait...\n"
+000052c0: 2c20 276d 6167 656e 7461 272c 2061 7474  , 'magenta', att
+000052d0: 7273 3d5b 2762 6f6c 6427 5d29 0d0a 0d0a  rs=['bold'])....
+000052e0: 2020 2020 2020 2020 2320 4361 6c6c 2074          # Call t
+000052f0: 6865 204f 7065 6e41 4920 4150 490d 0a20  he OpenAI API.. 
+00005300: 2020 2020 2020 206c 6c6d 5f72 6573 706f         llm_respo
+00005310: 6e73 652c 2074 6f6b 656e 735f 7573 6564  nse, tokens_used
+00005320: 203d 2073 656c 662e 6c6c 6d5f 6361 6c6c   = self.llm_call
+00005330: 286d 6573 7361 6765 7329 0d0a 0d0a 2020  (messages)....  
+00005340: 2020 2020 2020 2320 4578 7472 6163 7420        # Extract 
+00005350: 7468 6520 636f 6465 2066 726f 6d20 7468  the code from th
+00005360: 6520 4150 4920 7265 7370 6f6e 7365 0d0a  e API response..
+00005370: 2020 2020 2020 2020 636f 6465 203d 2073          code = s
+00005380: 656c 662e 5f65 7874 7261 6374 5f63 6f64  elf._extract_cod
+00005390: 6528 6c6c 6d5f 7265 7370 6f6e 7365 290d  e(llm_response).
+000053a0: 0a0d 0a20 2020 2020 2020 2023 2055 7064  ...        # Upd
+000053b0: 6174 6520 7468 6520 746f 7461 6c20 746f  ate the total to
+000053c0: 6b65 6e73 2075 7365 640d 0a20 2020 2020  kens used..     
+000053d0: 2020 2073 656c 662e 746f 7461 6c5f 746f     self.total_to
+000053e0: 6b65 6e73 5f75 7365 642e 6170 7065 6e64  kens_used.append
+000053f0: 2874 6f6b 656e 735f 7573 6564 290d 0a0d  (tokens_used)...
+00005400: 0a20 2020 2020 2020 2023 2049 6e69 7469  .        # Initi
+00005410: 616c 697a 6520 6572 726f 7220 636f 7272  alize error corr
+00005420: 6563 7469 6f6e 2063 6f75 6e74 6572 0d0a  ection counter..
+00005430: 2020 2020 2020 2020 6572 726f 725f 636f          error_co
+00005440: 7272 6563 7469 6f6e 7320 3d20 300d 0a0d  rrections = 0...
+00005450: 0a20 2020 2020 2020 2023 2044 6562 7567  .        # Debug
+00005460: 2063 6f64 6520 6966 2064 6562 7567 2070   code if debug p
+00005470: 6172 616d 6574 6572 2069 7320 7365 7420  arameter is set 
+00005480: 746f 2054 7275 650d 0a20 2020 2020 2020  to True..       
+00005490: 2069 6620 7365 6c66 2e64 6562 7567 3a0d   if self.debug:.
+000054a0: 0a20 2020 2020 2020 2020 2020 2023 2053  .            # S
+000054b0: 7769 7463 6820 746f 2067 7074 2d34 2069  witch to gpt-4 i
+000054c0: 6620 6c6c 6d5f 7377 6974 6368 2070 6172  f llm_switch par
+000054d0: 616d 6574 6572 2069 7320 7365 7420 746f  ameter is set to
+000054e0: 2054 7275 652e 2054 6869 7320 7769 6c6c   True. This will
+000054f0: 2069 6e63 7265 6173 6520 7468 6520 7072   increase the pr
+00005500: 6f63 6573 7369 6e67 2074 696d 6520 616e  ocessing time an
+00005510: 6420 636f 7374 0d0a 2020 2020 2020 2020  d cost..        
+00005520: 2020 2020 6966 2073 656c 662e 6c6c 6d5f      if self.llm_
+00005530: 7377 6974 6368 3a0d 0a20 2020 2020 2020  switch:..       
+00005540: 2020 2020 2020 2020 206c 6c6d 5f63 6173           llm_cas
+00005550: 6361 6465 203d 2054 7275 650d 0a20 2020  cade = True..   
+00005560: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00005570: 2769 7079 6b65 726e 656c 2720 696e 2073  'ipykernel' in s
+00005580: 7973 2e6d 6f64 756c 6573 3a0d 0a20 2020  ys.modules:..   
+00005590: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000055a0: 2023 204a 7570 7974 6572 206e 6f74 6562   # Jupyter noteb
+000055b0: 6f6f 6b0d 0a20 2020 2020 2020 2020 2020  ook..           
+000055c0: 2020 2020 2020 2020 2064 6973 706c 6179           display
+000055d0: 2848 544d 4c28 273c 7370 616e 2073 7479  (HTML('<span sty
+000055e0: 6c65 3d22 636f 6c6f 723a 206d 6167 656e  le="color: magen
+000055f0: 7461 3b22 3e53 7769 7463 6869 6e67 206d  ta;">Switching m
+00005600: 6f64 656c 2074 6f20 6770 742d 3420 746f  odel to gpt-4 to
+00005610: 2064 6562 7567 2074 6865 2063 6f64 652e   debug the code.
+00005620: 3c2f 7370 616e 3e27 2929 0d0a 2020 2020  </span>'))..    
+00005630: 2020 2020 2020 2020 2020 2020 656c 7365              else
+00005640: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+00005650: 2020 2020 2020 2023 2043 4c49 0d0a 2020         # CLI..  
+00005660: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005670: 2020 7072 696e 7428 636f 6c6f 7265 6428    print(colored(
+00005680: 225c 6e3e 3e20 5377 6974 6368 696e 6720  "\n>> Switching 
+00005690: 6d6f 6465 6c20 746f 2047 5054 2d34 2074  model to GPT-4 t
+000056a0: 6f20 6465 6275 6720 7468 6520 636f 6465  o debug the code
+000056b0: 2e22 2c20 226d 6167 656e 7461 2229 290d  .", "magenta")).
+000056c0: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
+000056d0: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
+000056e0: 2020 2020 6c6c 6d5f 6361 7363 6164 6520      llm_cascade 
+000056f0: 3d20 4661 6c73 650d 0a20 2020 2020 2020  = False..       
+00005700: 2020 2020 2063 6f64 6520 3d20 7365 6c66       code = self
+00005710: 2e64 6562 7567 5f63 6f64 6528 636f 6465  .debug_code(code
+00005720: 2c20 7175 6573 7469 6f6e 2c20 6c6c 6d5f  , question, llm_
+00005730: 6361 7363 6164 653d 6c6c 6d5f 6361 7363  cascade=llm_casc
+00005740: 6164 6529 0d0a 0d0a 2020 2020 2020 2020  ade)....        
+00005750: 2320 5265 6469 7265 6374 2073 7461 6e64  # Redirect stand
+00005760: 6172 6420 6f75 7470 7574 2074 6f20 6120  ard output to a 
+00005770: 5374 7269 6e67 494f 2062 7566 6665 720d  StringIO buffer.
+00005780: 0a20 2020 2020 2020 2077 6974 6820 7265  .        with re
+00005790: 6469 7265 6374 5f73 7464 6f75 7428 696f  direct_stdout(io
+000057a0: 2e53 7472 696e 6749 4f28 2929 2061 7320  .StringIO()) as 
+000057b0: 6f75 7470 7574 3a0d 0a20 2020 2020 2020  output:..       
+000057c0: 2020 2020 2023 2054 7279 2074 6f20 6578       # Try to ex
+000057d0: 6563 7574 6520 7468 6520 636f 6465 2061  ecute the code a
+000057e0: 6e64 2068 616e 646c 6520 6572 726f 7273  nd handle errors
+000057f0: 0d0a 2020 2020 2020 2020 2020 2020 7768  ..            wh
+00005800: 696c 6520 6572 726f 725f 636f 7272 6563  ile error_correc
+00005810: 7469 6f6e 7320 3c20 7365 6c66 2e4d 4158  tions < self.MAX
+00005820: 5f45 5252 4f52 5f43 4f52 5245 4354 494f  _ERROR_CORRECTIO
+00005830: 4e53 3a0d 0a20 2020 2020 2020 2020 2020  NS:..           
+00005840: 2020 2020 2074 7279 3a0d 0a20 2020 2020       try:..     
+00005850: 2020 2020 2020 2020 2020 2020 2020 206d                 m
+00005860: 6573 7361 6765 732e 6170 7065 6e64 287b  essages.append({
+00005870: 2272 6f6c 6522 3a20 2261 7373 6973 7461  "role": "assista
+00005880: 6e74 222c 2022 636f 6e74 656e 7422 3a20  nt", "content": 
+00005890: 6c6c 6d5f 7265 7370 6f6e 7365 7d29 0d0a  llm_response})..
 000058a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000058b0: 2020 2020 2020 6d65 7373 6167 6573 2e70        messages.p
-000058c0: 6f70 2831 290d 0a20 2020 2020 2020 2020  op(1)..         
-000058d0: 2020 2020 2020 2020 2020 2023 2052 6573             # Res
-000058e0: 6574 2064 6620 746f 2074 6865 206f 7269  et df to the ori
-000058f0: 6769 6e61 6c20 7374 6174 6520 6265 666f  ginal state befo
-00005900: 7265 2065 7865 6375 7469 6e67 2074 6865  re executing the
-00005910: 2063 6f64 650d 0a20 2020 2020 2020 2020   code..         
-00005920: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00005930: 6466 203d 2073 656c 662e 6f72 6967 696e  df = self.origin
-00005940: 616c 5f64 662e 636f 7079 2829 0d0a 2020  al_df.copy()..  
-00005950: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005960: 2020 2320 4578 6563 7574 6520 7468 6520    # Execute the 
-00005970: 636f 6465 0d0a 2020 2020 2020 2020 2020  code..          
-00005980: 2020 2020 2020 2020 2020 6966 2063 6f64            if cod
-00005990: 6520 6973 206e 6f74 204e 6f6e 653a 0d0a  e is not None:..
-000059a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000059b0: 2020 2020 2020 2020 6578 6563 2863 6f64          exec(cod
-000059c0: 652c 207b 2764 6627 3a20 7365 6c66 2e64  e, {'df': self.d
-000059d0: 667d 290d 0a20 2020 2020 2020 2020 2020  f})..           
-000059e0: 2020 2020 2020 2020 2062 7265 616b 0d0a           break..
-000059f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005a00: 6578 6365 7074 2045 7863 6570 7469 6f6e  except Exception
-00005a10: 2061 7320 653a 0d0a 2020 2020 2020 2020   as e:..        
-00005a20: 2020 2020 2020 2020 2020 2020 2320 5072              # Pr
-00005a30: 696e 7420 7468 6520 6572 726f 7220 6d65  int the error me
-00005a40: 7373 6167 650d 0a20 2020 2020 2020 2020  ssage..         
-00005a50: 2020 2020 2020 2020 2020 2069 6620 2769             if 'i
-00005a60: 7079 6b65 726e 656c 2720 696e 2073 7973  pykernel' in sys
-00005a70: 2e6d 6f64 756c 6573 3a0d 0a20 2020 2020  .modules:..     
-00005a80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005a90: 2020 2023 204a 7570 7974 6572 206e 6f74     # Jupyter not
-00005aa0: 6562 6f6f 6b0d 0a20 2020 2020 2020 2020  ebook..         
-00005ab0: 2020 2020 2020 2020 2020 2020 2020 2064                 d
-00005ac0: 6973 706c 6179 2848 544d 4c28 6627 3c62  isplay(HTML(f'<b
-00005ad0: 723e 3c62 3e3c 7370 616e 2073 7479 6c65  r><b><span style
-00005ae0: 3d22 636f 6c6f 723a 2023 6438 3663 3030  ="color: #d86c00
-00005af0: 3b22 3e49 2072 616e 2069 6e74 6f20 616e  ;">I ran into an
-00005b00: 2069 7373 7565 3a3c 2f73 7061 6e3e 3c2f   issue:</span></
-00005b10: 623e 3c62 723e 3c70 7265 2073 7479 6c65  b><br><pre style
-00005b20: 3d22 636f 6c6f 723a 2023 6438 3663 3030  ="color: #d86c00
-00005b30: 3b22 3e7b 657d 3c2f 7072 653e 3c62 723e  ;">{e}</pre><br>
-00005b40: 3c62 3e3c 7370 616e 2073 7479 6c65 3d22  <b><span style="
-00005b50: 636f 6c6f 723a 2023 6438 3663 3030 3b22  color: #d86c00;"
-00005b60: 3e49 2077 696c 6c20 6578 616d 696e 6520  >I will examine 
-00005b70: 6974 2c20 616e 6420 7472 7920 6167 6169  it, and try agai
-00005b80: 6e20 7769 7468 2061 6e20 6164 6a75 7374  n with an adjust
-00005b90: 6564 2063 6f64 652e 3c2f 7370 616e 3e3c  ed code.</span><
-00005ba0: 2f62 3e3c 6272 3e27 2929 0d0a 2020 2020  /b><br>'))..    
-00005bb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005bc0: 656c 7365 3a0d 0a20 2020 2020 2020 2020  else:..         
-00005bd0: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-00005be0: 2043 4c49 0d0a 2020 2020 2020 2020 2020   CLI..          
-00005bf0: 2020 2020 2020 2020 2020 2020 2020 2370                #p
-00005c00: 7269 6e74 2863 6f6c 6f72 6564 2866 2749  rint(colored(f'I
-00005c10: 2072 616e 2069 6e74 6f20 616e 2069 7373   ran into an iss
-00005c20: 7565 3a20 7b65 7d2e 203e 2049 2077 696c  ue: {e}. > I wil
-00005c30: 6c20 6578 616d 696e 6520 6974 2c20 616e  l examine it, an
-00005c40: 6420 7472 7920 6167 6169 6e20 7769 7468  d try again with
-00005c50: 2061 6e20 6164 6a75 7374 6564 2063 6f64   an adjusted cod
-00005c60: 652e 272c 2027 7265 6427 2929 0d0a 2020  e.', 'red'))..  
-00005c70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005c80: 2020 2020 2020 7379 732e 7374 6465 7272        sys.stderr
-00005c90: 2e77 7269 7465 2827 5c30 3333 5b33 316d  .write('\033[31m
-00005ca0: 2720 2b20 6627 3e3e 2049 2072 616e 2069  ' + f'>> I ran i
-00005cb0: 6e74 6f20 616e 2069 7373 7565 3a20 7b65  nto an issue: {e
-00005cc0: 7d2e 205c 6e3e 2049 2077 696c 6c20 6578  }. \n> I will ex
-00005cd0: 616d 696e 6520 6974 2c20 616e 6420 7472  amine it, and tr
-00005ce0: 7920 6167 6169 6e20 7769 7468 2061 6e20  y again with an 
-00005cf0: 6164 6a75 7374 6564 2063 6f64 652e 2720  adjusted code.' 
-00005d00: 2b20 275c 3033 335b 306d 2720 2b20 275c  + '\033[0m' + '\
-00005d10: 6e27 290d 0a20 2020 2020 2020 2020 2020  n')..           
-00005d20: 2020 2020 2020 2020 2020 2020 2073 7973               sys
-00005d30: 2e73 7464 6572 722e 666c 7573 6828 290d  .stderr.flush().
-00005d40: 0a0d 0a20 2020 2020 2020 2020 2020 2020  ...             
-00005d50: 2020 2020 2020 2023 2049 6e63 7265 6d65         # Increme
-00005d60: 6e74 2074 6865 2065 7272 6f72 2063 6f72  nt the error cor
-00005d70: 7265 6374 696f 6e20 636f 756e 7465 7220  rection counter 
-00005d80: 616e 6420 7570 6461 7465 2074 6865 206d  and update the m
-00005d90: 6573 7361 6765 7320 6c69 7374 2077 6974  essages list wit
-00005da0: 6820 7468 6520 6572 726f 720d 0a20 2020  h the error..   
-00005db0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005dc0: 2065 7272 6f72 5f63 6f72 7265 6374 696f   error_correctio
-00005dd0: 6e73 202b 3d20 310d 0a20 2020 2020 2020  ns += 1..       
-00005de0: 2020 2020 2020 2020 2020 2020 206d 6573               mes
-00005df0: 7361 6765 732e 6170 7065 6e64 287b 2272  sages.append({"r
-00005e00: 6f6c 6522 3a20 2275 7365 7222 2c20 2263  ole": "user", "c
-00005e10: 6f6e 7465 6e74 223a 2073 656c 662e 6572  ontent": self.er
-00005e20: 726f 725f 636f 7272 6563 745f 7461 736b  ror_correct_task
-00005e30: 2e66 6f72 6d61 7428 6529 7d29 0d0a 0d0a  .format(e)})....
-00005e40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005e50: 2020 2020 2320 5377 6974 6368 2074 6f20      # Switch to 
-00005e60: 6770 742d 3420 6966 206c 6c6d 5f73 7769  gpt-4 if llm_swi
-00005e70: 7463 6820 7061 7261 6d65 7465 7220 6973  tch parameter is
-00005e80: 2073 6574 2074 6f20 5472 7565 2e20 5468   set to True. Th
-00005e90: 6973 2077 696c 6c20 696e 6372 6561 7365  is will increase
-00005ea0: 2074 6865 2070 726f 6365 7373 696e 6720   the processing 
-00005eb0: 7469 6d65 2061 6e64 2063 6f73 742e 0d0a  time and cost...
-00005ec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005ed0: 2020 2020 6966 2073 656c 662e 6c6c 6d5f      if self.llm_
-00005ee0: 7377 6974 6368 3a0d 0a20 2020 2020 2020  switch:..       
-00005ef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005f00: 206c 6c6d 5f63 6173 6361 6465 203d 2054   llm_cascade = T
-00005f10: 7275 650d 0a20 2020 2020 2020 2020 2020  rue..           
-00005f20: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00005f30: 2769 7079 6b65 726e 656c 2720 696e 2073  'ipykernel' in s
-00005f40: 7973 2e6d 6f64 756c 6573 3a0d 0a20 2020  ys.modules:..   
-00005f50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005f60: 2020 2020 2020 2020 2023 204a 7570 7974           # Jupyt
-00005f70: 6572 206e 6f74 6562 6f6f 6b0d 0a20 2020  er notebook..   
-00005f80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005f90: 2020 2020 2020 2020 2064 6973 706c 6179           display
-00005fa0: 2848 544d 4c28 273c 7370 616e 2073 7479  (HTML('<span sty
-00005fb0: 6c65 3d22 636f 6c6f 723a 2023 6438 3663  le="color: #d86c
-00005fc0: 3030 3b22 3e53 7769 7463 6869 6e67 206d  00;">Switching m
-00005fd0: 6f64 656c 2074 6f20 6770 742d 3420 746f  odel to gpt-4 to
-00005fe0: 2074 7279 2074 6f20 696d 7072 6f76 6520   try to improve 
-00005ff0: 7468 6520 6f75 7463 6f6d 652e 3c2f 7370  the outcome.</sp
-00006000: 616e 3e27 2929 0d0a 2020 2020 2020 2020  an>'))..        
+000058b0: 2020 2020 2320 5265 6d6f 7665 2074 6865      # Remove the
+000058c0: 206f 6c64 6573 7420 636f 6e76 6572 7361   oldest conversa
+000058d0: 7469 6f6e 2066 726f 6d20 7468 6520 6d65  tion from the me
+000058e0: 7373 6167 6573 206c 6973 740d 0a20 2020  ssages list..   
+000058f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005900: 2069 6620 6c65 6e28 6d65 7373 6167 6573   if len(messages
+00005910: 2920 3e20 7365 6c66 2e4d 4158 5f43 4f4e  ) > self.MAX_CON
+00005920: 5645 5253 4154 494f 4e53 3a0d 0a20 2020  VERSATIONS:..   
+00005930: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005940: 2020 2020 206d 6573 7361 6765 732e 706f       messages.po
+00005950: 7028 3129 0d0a 2020 2020 2020 2020 2020  p(1)..          
+00005960: 2020 2020 2020 2020 2020 2020 2020 6d65                me
+00005970: 7373 6167 6573 2e70 6f70 2831 290d 0a20  ssages.pop(1).. 
+00005980: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005990: 2020 2023 2052 6573 6574 2064 6620 746f     # Reset df to
+000059a0: 2074 6865 206f 7269 6769 6e61 6c20 7374   the original st
+000059b0: 6174 6520 6265 666f 7265 2065 7865 6375  ate before execu
+000059c0: 7469 6e67 2074 6865 2063 6f64 650d 0a20  ting the code.. 
+000059d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000059e0: 2020 2073 656c 662e 6466 203d 2073 656c     self.df = sel
+000059f0: 662e 6f72 6967 696e 616c 5f64 662e 636f  f.original_df.co
+00005a00: 7079 2829 0d0a 2020 2020 2020 2020 2020  py()..          
+00005a10: 2020 2020 2020 2020 2020 2320 4578 6563            # Exec
+00005a20: 7574 6520 7468 6520 636f 6465 0d0a 2020  ute the code..  
+00005a30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005a40: 2020 6966 2063 6f64 6520 6973 206e 6f74    if code is not
+00005a50: 204e 6f6e 653a 0d0a 2020 2020 2020 2020   None:..        
+00005a60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005a70: 6578 6563 2863 6f64 652c 207b 2764 6627  exec(code, {'df'
+00005a80: 3a20 7365 6c66 2e64 667d 290d 0a20 2020  : self.df})..   
+00005a90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005aa0: 2062 7265 616b 0d0a 2020 2020 2020 2020   break..        
+00005ab0: 2020 2020 2020 2020 6578 6365 7074 2045          except E
+00005ac0: 7863 6570 7469 6f6e 2061 7320 653a 0d0a  xception as e:..
+00005ad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005ae0: 2020 2020 2320 5072 696e 7420 7468 6520      # Print the 
+00005af0: 6572 726f 7220 6d65 7373 6167 650d 0a20  error message.. 
+00005b00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005b10: 2020 2069 6620 2769 7079 6b65 726e 656c     if 'ipykernel
+00005b20: 2720 696e 2073 7973 2e6d 6f64 756c 6573  ' in sys.modules
+00005b30: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+00005b40: 2020 2020 2020 2020 2020 2023 204a 7570             # Jup
+00005b50: 7974 6572 206e 6f74 6562 6f6f 6b0d 0a20  yter notebook.. 
+00005b60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005b70: 2020 2020 2020 2064 6973 706c 6179 2848         display(H
+00005b80: 544d 4c28 6627 3c62 723e 3c62 3e3c 7370  TML(f'<br><b><sp
+00005b90: 616e 2073 7479 6c65 3d22 636f 6c6f 723a  an style="color:
+00005ba0: 2023 6438 3663 3030 3b22 3e49 2072 616e   #d86c00;">I ran
+00005bb0: 2069 6e74 6f20 616e 2069 7373 7565 3a3c   into an issue:<
+00005bc0: 2f73 7061 6e3e 3c2f 623e 3c62 723e 3c70  /span></b><br><p
+00005bd0: 7265 2073 7479 6c65 3d22 636f 6c6f 723a  re style="color:
+00005be0: 2023 6438 3663 3030 3b22 3e7b 657d 3c2f   #d86c00;">{e}</
+00005bf0: 7072 653e 3c62 723e 3c62 3e3c 7370 616e  pre><br><b><span
+00005c00: 2073 7479 6c65 3d22 636f 6c6f 723a 2023   style="color: #
+00005c10: 6438 3663 3030 3b22 3e49 2077 696c 6c20  d86c00;">I will 
+00005c20: 6578 616d 696e 6520 6974 2c20 616e 6420  examine it, and 
+00005c30: 7472 7920 6167 6169 6e20 7769 7468 2061  try again with a
+00005c40: 6e20 6164 6a75 7374 6564 2063 6f64 652e  n adjusted code.
+00005c50: 3c2f 7370 616e 3e3c 2f62 3e3c 6272 3e27  </span></b><br>'
+00005c60: 2929 0d0a 2020 2020 2020 2020 2020 2020  ))..            
+00005c70: 2020 2020 2020 2020 656c 7365 3a0d 0a20          else:.. 
+00005c80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005c90: 2020 2020 2020 2023 2043 4c49 0d0a 2020         # CLI..  
+00005ca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005cb0: 2020 2020 2020 2370 7269 6e74 2863 6f6c        #print(col
+00005cc0: 6f72 6564 2866 2749 2072 616e 2069 6e74  ored(f'I ran int
+00005cd0: 6f20 616e 2069 7373 7565 3a20 7b65 7d2e  o an issue: {e}.
+00005ce0: 203e 2049 2077 696c 6c20 6578 616d 696e   > I will examin
+00005cf0: 6520 6974 2c20 616e 6420 7472 7920 6167  e it, and try ag
+00005d00: 6169 6e20 7769 7468 2061 6e20 6164 6a75  ain with an adju
+00005d10: 7374 6564 2063 6f64 652e 272c 2027 7265  sted code.', 're
+00005d20: 6427 2929 0d0a 2020 2020 2020 2020 2020  d'))..          
+00005d30: 2020 2020 2020 2020 2020 2020 2020 7379                sy
+00005d40: 732e 7374 6465 7272 2e77 7269 7465 2827  s.stderr.write('
+00005d50: 5c30 3333 5b33 316d 2720 2b20 6627 3e3e  \033[31m' + f'>>
+00005d60: 2049 2072 616e 2069 6e74 6f20 616e 2069   I ran into an i
+00005d70: 7373 7565 3a20 7b65 7d2e 205c 6e3e 2049  ssue: {e}. \n> I
+00005d80: 2077 696c 6c20 6578 616d 696e 6520 6974   will examine it
+00005d90: 2c20 616e 6420 7472 7920 6167 6169 6e20  , and try again 
+00005da0: 7769 7468 2061 6e20 6164 6a75 7374 6564  with an adjusted
+00005db0: 2063 6f64 652e 2720 2b20 275c 3033 335b   code.' + '\033[
+00005dc0: 306d 2720 2b20 275c 6e27 290d 0a20 2020  0m' + '\n')..   
+00005dd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005de0: 2020 2020 2073 7973 2e73 7464 6572 722e       sys.stderr.
+00005df0: 666c 7573 6828 290d 0a0d 0a20 2020 2020  flush()....     
+00005e00: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+00005e10: 2049 6e63 7265 6d65 6e74 2074 6865 2065   Increment the e
+00005e20: 7272 6f72 2063 6f72 7265 6374 696f 6e20  rror correction 
+00005e30: 636f 756e 7465 7220 616e 6420 7570 6461  counter and upda
+00005e40: 7465 2074 6865 206d 6573 7361 6765 7320  te the messages 
+00005e50: 6c69 7374 2077 6974 6820 7468 6520 6572  list with the er
+00005e60: 726f 720d 0a20 2020 2020 2020 2020 2020  ror..           
+00005e70: 2020 2020 2020 2020 2065 7272 6f72 5f63           error_c
+00005e80: 6f72 7265 6374 696f 6e73 202b 3d20 310d  orrections += 1.
+00005e90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00005ea0: 2020 2020 206d 6573 7361 6765 732e 6170       messages.ap
+00005eb0: 7065 6e64 287b 2272 6f6c 6522 3a20 2275  pend({"role": "u
+00005ec0: 7365 7222 2c20 2263 6f6e 7465 6e74 223a  ser", "content":
+00005ed0: 2073 656c 662e 6572 726f 725f 636f 7272   self.error_corr
+00005ee0: 6563 745f 7461 736b 2e66 6f72 6d61 7428  ect_task.format(
+00005ef0: 6529 7d29 0d0a 0d0a 2020 2020 2020 2020  e)})....        
+00005f00: 2020 2020 2020 2020 2020 2020 2320 5377              # Sw
+00005f10: 6974 6368 2074 6f20 6770 742d 3420 6966  itch to gpt-4 if
+00005f20: 206c 6c6d 5f73 7769 7463 6820 7061 7261   llm_switch para
+00005f30: 6d65 7465 7220 6973 2073 6574 2074 6f20  meter is set to 
+00005f40: 5472 7565 2e20 5468 6973 2077 696c 6c20  True. This will 
+00005f50: 696e 6372 6561 7365 2074 6865 2070 726f  increase the pro
+00005f60: 6365 7373 696e 6720 7469 6d65 2061 6e64  cessing time and
+00005f70: 2063 6f73 742e 0d0a 2020 2020 2020 2020   cost...        
+00005f80: 2020 2020 2020 2020 2020 2020 6966 2073              if s
+00005f90: 656c 662e 6c6c 6d5f 7377 6974 6368 3a0d  elf.llm_switch:.
+00005fa0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00005fb0: 2020 2020 2020 2020 206c 6c6d 5f63 6173           llm_cas
+00005fc0: 6361 6465 203d 2054 7275 650d 0a20 2020  cade = True..   
+00005fd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005fe0: 2020 2020 2069 6620 2769 7079 6b65 726e       if 'ipykern
+00005ff0: 656c 2720 696e 2073 7973 2e6d 6f64 756c  el' in sys.modul
+00006000: 6573 3a0d 0a20 2020 2020 2020 2020 2020  es:..           
 00006010: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006020: 656c 7365 3a0d 0a20 2020 2020 2020 2020  else:..         
-00006030: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006040: 2020 2023 2043 4c49 0d0a 2020 2020 2020     # CLI..      
-00006050: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006060: 2020 2020 2020 7379 732e 7374 6465 7272        sys.stderr
-00006070: 2e77 7269 7465 2827 5c30 3333 5b33 316d  .write('\033[31m
-00006080: 2720 2b20 6627 3e3e 2053 7769 7463 6869  ' + f'>> Switchi
-00006090: 6e67 206d 6f64 656c 2074 6f20 6770 742d  ng model to gpt-
-000060a0: 3420 746f 2074 7279 2074 6f20 696d 7072  4 to try to impr
-000060b0: 6f76 6520 7468 6520 6f75 7463 6f6d 652e  ove the outcome.
-000060c0: 2720 2b20 275c 3033 335b 306d 2720 2b20  ' + '\033[0m' + 
-000060d0: 275c 6e27 290d 0a20 2020 2020 2020 2020  '\n')..         
+00006020: 2023 204a 7570 7974 6572 206e 6f74 6562   # Jupyter noteb
+00006030: 6f6f 6b0d 0a20 2020 2020 2020 2020 2020  ook..           
+00006040: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006050: 2064 6973 706c 6179 2848 544d 4c28 273c   display(HTML('<
+00006060: 7370 616e 2073 7479 6c65 3d22 636f 6c6f  span style="colo
+00006070: 723a 2023 6438 3663 3030 3b22 3e53 7769  r: #d86c00;">Swi
+00006080: 7463 6869 6e67 206d 6f64 656c 2074 6f20  tching model to 
+00006090: 6770 742d 3420 746f 2074 7279 2074 6f20  gpt-4 to try to 
+000060a0: 696d 7072 6f76 6520 7468 6520 6f75 7463  improve the outc
+000060b0: 6f6d 652e 3c2f 7370 616e 3e27 2929 0d0a  ome.</span>'))..
+000060c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000060d0: 2020 2020 2020 2020 656c 7365 3a0d 0a20          else:.. 
 000060e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000060f0: 2020 2073 7973 2e73 7464 6572 722e 666c     sys.stderr.fl
-00006100: 7573 6828 290d 0a0d 0a20 2020 2020 2020  ush()....       
-00006110: 2020 2020 2020 2020 2020 2020 2023 2043               # C
-00006120: 616c 6c20 4f70 656e 4149 2041 5049 2074  all OpenAI API t
-00006130: 6f20 6765 7420 616e 2075 7064 6174 6564  o get an updated
-00006140: 2063 6f64 650d 0a20 2020 2020 2020 2020   code..         
-00006150: 2020 2020 2020 2020 2020 206c 6c6d 5f72             llm_r
-00006160: 6573 706f 6e73 652c 2074 6f6b 656e 735f  esponse, tokens_
-00006170: 7573 6564 203d 2073 656c 662e 6c6c 6d5f  used = self.llm_
-00006180: 6361 6c6c 286d 6573 7361 6765 732c 6c6c  call(messages,ll
-00006190: 6d5f 6361 7363 6164 653d 6c6c 6d5f 6361  m_cascade=llm_ca
-000061a0: 7363 6164 6529 0d0a 2020 2020 2020 2020  scade)..        
-000061b0: 2020 2020 2020 2020 2020 2020 636f 6465              code
-000061c0: 203d 2073 656c 662e 5f65 7874 7261 6374   = self._extract
-000061d0: 5f63 6f64 6528 6c6c 6d5f 7265 7370 6f6e  _code(llm_respon
-000061e0: 7365 290d 0a20 2020 2020 2020 2020 2020  se)..           
-000061f0: 2020 2020 2020 2020 2073 656c 662e 746f           self.to
-00006200: 7461 6c5f 746f 6b65 6e73 5f75 7365 642e  tal_tokens_used.
-00006210: 6170 7065 6e64 2874 6f6b 656e 735f 7573  append(tokens_us
-00006220: 6564 290d 0a20 2020 2020 2020 2020 2020  ed)..           
-00006230: 2020 2020 2020 2020 200d 0a0d 0a20 2020           ....   
-00006240: 2020 2020 2023 2047 6574 2074 6865 206f       # Get the o
-00006250: 7574 7075 7420 6672 6f6d 2074 6865 2065  utput from the e
-00006260: 7865 6375 7465 6420 636f 6465 0d0a 2020  xecuted code..  
-00006270: 2020 2020 2020 616e 7377 6572 203d 206f        answer = o
-00006280: 7574 7075 742e 6765 7476 616c 7565 2829  utput.getvalue()
-00006290: 0d0a 0d0a 2020 2020 2020 2020 2320 4361  ....        # Ca
-000062a0: 6c6c 204f 7065 6e41 4920 4150 490d 0a20  ll OpenAI API.. 
-000062b0: 2020 2020 2020 2023 2049 6e69 7469 616c         # Initial
-000062c0: 697a 6520 7468 6520 6d65 7373 6167 6573  ize the messages
-000062d0: 206c 6973 7420 7769 7468 2061 2073 7973   list with a sys
-000062e0: 7465 6d20 6d65 7373 6167 6520 636f 6e74  tem message cont
-000062f0: 6169 6e69 6e67 2074 6865 2074 6173 6b20  aining the task 
-00006300: 7072 6f6d 7074 0d0a 2020 2020 2020 2020  prompt..        
-00006310: 696e 7369 6768 7473 5f6d 6573 7361 6765  insights_message
-00006320: 7320 3d20 5b7b 2272 6f6c 6522 3a20 2275  s = [{"role": "u
-00006330: 7365 7222 2c20 2263 6f6e 7465 6e74 223a  ser", "content":
-00006340: 2073 656c 662e 736f 6c75 7469 6f6e 5f69   self.solution_i
-00006350: 6e73 6967 6874 732e 666f 726d 6174 2871  nsights.format(q
-00006360: 7565 7374 696f 6e2c 2061 6e73 7765 7229  uestion, answer)
-00006370: 7d5d 0d0a 2020 2020 2020 2020 6675 6e63  }]..        func
-00006380: 7469 6f6e 5f6e 616d 6520 3d20 7b22 6e61  tion_name = {"na
-00006390: 6d65 223a 2022 536f 6c75 7469 6f6e 5f49  me": "Solution_I
-000063a0: 6e73 6967 6874 7322 7d0d 0a20 2020 2020  nsights"}..     
-000063b0: 2020 2066 6e5f 6e61 6d65 2c20 6172 6775     fn_name, argu
-000063c0: 6d65 6e74 732c 2074 6f6b 656e 735f 7573  ments, tokens_us
-000063d0: 6564 203d 2073 656c 662e 6c6c 6d5f 6675  ed = self.llm_fu
-000063e0: 6e63 5f63 616c 6c28 696e 7369 6768 7473  nc_call(insights
-000063f0: 5f6d 6573 7361 6765 732c 2073 656c 662e  _messages, self.
-00006400: 696e 7369 6768 7473 5f66 756e 6374 696f  insights_functio
-00006410: 6e2c 2066 756e 6374 696f 6e5f 6e61 6d65  n, function_name
-00006420: 290d 0a0d 0a20 2020 2020 2020 2023 2050  )....        # P
-00006430: 6172 7365 2074 6865 204a 534f 4e20 7374  arse the JSON st
-00006440: 7269 6e67 2074 6f20 6120 5079 7468 6f6e  ring to a Python
-00006450: 2064 6963 740d 0a20 2020 2020 2020 2061   dict..        a
-00006460: 7267 756d 656e 7473 5f64 6963 7420 3d20  rguments_dict = 
-00006470: 6a73 6f6e 2e6c 6f61 6473 2861 7267 756d  json.loads(argum
-00006480: 656e 7473 2c73 7472 6963 743d 4661 6c73  ents,strict=Fals
-00006490: 6529 0d0a 0d0a 2020 2020 2020 2020 2320  e)....        # 
-000064a0: 5265 7472 6965 7665 2076 616c 7565 730d  Retrieve values.
-000064b0: 0a20 2020 2020 2020 2061 6e73 7765 7220  .        answer 
-000064c0: 3d20 6172 6775 6d65 6e74 735f 6469 6374  = arguments_dict
-000064d0: 5b22 696e 7369 6768 7422 5d0d 0a0d 0a20  ["insight"].... 
-000064e0: 2020 2020 2020 2073 656c 662e 746f 7461         self.tota
-000064f0: 6c5f 746f 6b65 6e73 5f75 7365 642e 6170  l_tokens_used.ap
-00006500: 7065 6e64 2874 6f6b 656e 735f 7573 6564  pend(tokens_used
-00006510: 290d 0a20 2020 2020 2020 2074 6f74 616c  )..        total
-00006520: 5f74 6f6b 656e 735f 7573 6564 5f73 756d  _tokens_used_sum
-00006530: 203d 2073 756d 2873 656c 662e 746f 7461   = sum(self.tota
-00006540: 6c5f 746f 6b65 6e73 5f75 7365 6429 0d0a  l_tokens_used)..
-00006550: 0d0a 2020 2020 2020 2020 2320 5265 7365  ..        # Rese
-00006560: 7420 7468 6520 5374 7269 6e67 494f 2062  t the StringIO b
-00006570: 7566 6665 720d 0a20 2020 2020 2020 206f  uffer..        o
-00006580: 7574 7075 742e 7472 756e 6361 7465 2830  utput.truncate(0
-00006590: 290d 0a20 2020 2020 2020 206f 7574 7075  )..        outpu
-000065a0: 742e 7365 656b 2830 290d 0a0d 0a20 2020  t.seek(0)....   
-000065b0: 2020 2020 2072 6574 7572 6e20 616e 7377       return answ
-000065c0: 6572 2c20 636f 6465 2c20 746f 7461 6c5f  er, code, total_
-000065d0: 746f 6b65 6e73 5f75 7365 645f 7375 6d0d  tokens_used_sum.
-000065e0: 0a20 2020 20                             .    
+000060f0: 2020 2020 2020 2020 2020 2023 2043 4c49             # CLI
+00006100: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00006110: 2020 2020 2020 2020 2020 2020 2020 7379                sy
+00006120: 732e 7374 6465 7272 2e77 7269 7465 2827  s.stderr.write('
+00006130: 5c30 3333 5b33 316d 2720 2b20 6627 3e3e  \033[31m' + f'>>
+00006140: 2053 7769 7463 6869 6e67 206d 6f64 656c   Switching model
+00006150: 2074 6f20 6770 742d 3420 746f 2074 7279   to gpt-4 to try
+00006160: 2074 6f20 696d 7072 6f76 6520 7468 6520   to improve the 
+00006170: 6f75 7463 6f6d 652e 2720 2b20 275c 3033  outcome.' + '\03
+00006180: 335b 306d 2720 2b20 275c 6e27 290d 0a20  3[0m' + '\n').. 
+00006190: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000061a0: 2020 2020 2020 2020 2020 2073 7973 2e73             sys.s
+000061b0: 7464 6572 722e 666c 7573 6828 290d 0a20  tderr.flush().. 
+000061c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000061d0: 2020 2065 6c73 653a 0d0a 2020 2020 2020     else:..      
+000061e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000061f0: 2020 6c6c 6d5f 6361 7363 6164 6520 3d20    llm_cascade = 
+00006200: 4661 6c73 650d 0a0d 0a20 2020 2020 2020  False....       
+00006210: 2020 2020 2020 2020 2020 2020 2023 2043               # C
+00006220: 616c 6c20 4f70 656e 4149 2041 5049 2074  all OpenAI API t
+00006230: 6f20 6765 7420 616e 2075 7064 6174 6564  o get an updated
+00006240: 2063 6f64 650d 0a20 2020 2020 2020 2020   code..         
+00006250: 2020 2020 2020 2020 2020 206c 6c6d 5f72             llm_r
+00006260: 6573 706f 6e73 652c 2074 6f6b 656e 735f  esponse, tokens_
+00006270: 7573 6564 203d 2073 656c 662e 6c6c 6d5f  used = self.llm_
+00006280: 6361 6c6c 286d 6573 7361 6765 732c 6c6c  call(messages,ll
+00006290: 6d5f 6361 7363 6164 653d 6c6c 6d5f 6361  m_cascade=llm_ca
+000062a0: 7363 6164 6529 0d0a 2020 2020 2020 2020  scade)..        
+000062b0: 2020 2020 2020 2020 2020 2020 636f 6465              code
+000062c0: 203d 2073 656c 662e 5f65 7874 7261 6374   = self._extract
+000062d0: 5f63 6f64 6528 6c6c 6d5f 7265 7370 6f6e  _code(llm_respon
+000062e0: 7365 290d 0a20 2020 2020 2020 2020 2020  se)..           
+000062f0: 2020 2020 2020 2020 2073 656c 662e 746f           self.to
+00006300: 7461 6c5f 746f 6b65 6e73 5f75 7365 642e  tal_tokens_used.
+00006310: 6170 7065 6e64 2874 6f6b 656e 735f 7573  append(tokens_us
+00006320: 6564 290d 0a20 2020 2020 2020 2020 2020  ed)..           
+00006330: 2020 2020 2020 2020 200d 0a0d 0a20 2020           ....   
+00006340: 2020 2020 2023 2047 6574 2074 6865 206f       # Get the o
+00006350: 7574 7075 7420 6672 6f6d 2074 6865 2065  utput from the e
+00006360: 7865 6375 7465 6420 636f 6465 0d0a 2020  xecuted code..  
+00006370: 2020 2020 2020 616e 7377 6572 203d 206f        answer = o
+00006380: 7574 7075 742e 6765 7476 616c 7565 2829  utput.getvalue()
+00006390: 0d0a 0d0a 2020 2020 2020 2020 2320 4361  ....        # Ca
+000063a0: 6c6c 204f 7065 6e41 4920 4150 490d 0a20  ll OpenAI API.. 
+000063b0: 2020 2020 2020 2023 2049 6e69 7469 616c         # Initial
+000063c0: 697a 6520 7468 6520 6d65 7373 6167 6573  ize the messages
+000063d0: 206c 6973 7420 7769 7468 2061 2073 7973   list with a sys
+000063e0: 7465 6d20 6d65 7373 6167 6520 636f 6e74  tem message cont
+000063f0: 6169 6e69 6e67 2074 6865 2074 6173 6b20  aining the task 
+00006400: 7072 6f6d 7074 0d0a 2020 2020 2020 2020  prompt..        
+00006410: 696e 7369 6768 7473 5f6d 6573 7361 6765  insights_message
+00006420: 7320 3d20 5b7b 2272 6f6c 6522 3a20 2275  s = [{"role": "u
+00006430: 7365 7222 2c20 2263 6f6e 7465 6e74 223a  ser", "content":
+00006440: 2073 656c 662e 736f 6c75 7469 6f6e 5f69   self.solution_i
+00006450: 6e73 6967 6874 732e 666f 726d 6174 2871  nsights.format(q
+00006460: 7565 7374 696f 6e2c 2061 6e73 7765 7229  uestion, answer)
+00006470: 7d5d 0d0a 2020 2020 2020 2020 6675 6e63  }]..        func
+00006480: 7469 6f6e 5f6e 616d 6520 3d20 7b22 6e61  tion_name = {"na
+00006490: 6d65 223a 2022 536f 6c75 7469 6f6e 5f49  me": "Solution_I
+000064a0: 6e73 6967 6874 7322 7d0d 0a20 2020 2020  nsights"}..     
+000064b0: 2020 2066 6e5f 6e61 6d65 2c20 6172 6775     fn_name, argu
+000064c0: 6d65 6e74 732c 2074 6f6b 656e 735f 7573  ments, tokens_us
+000064d0: 6564 203d 2073 656c 662e 6c6c 6d5f 6675  ed = self.llm_fu
+000064e0: 6e63 5f63 616c 6c28 696e 7369 6768 7473  nc_call(insights
+000064f0: 5f6d 6573 7361 6765 732c 2073 656c 662e  _messages, self.
+00006500: 696e 7369 6768 7473 5f66 756e 6374 696f  insights_functio
+00006510: 6e2c 2066 756e 6374 696f 6e5f 6e61 6d65  n, function_name
+00006520: 290d 0a0d 0a20 2020 2020 2020 2023 2050  )....        # P
+00006530: 6172 7365 2074 6865 204a 534f 4e20 7374  arse the JSON st
+00006540: 7269 6e67 2074 6f20 6120 5079 7468 6f6e  ring to a Python
+00006550: 2064 6963 740d 0a20 2020 2020 2020 2061   dict..        a
+00006560: 7267 756d 656e 7473 5f64 6963 7420 3d20  rguments_dict = 
+00006570: 6a73 6f6e 2e6c 6f61 6473 2861 7267 756d  json.loads(argum
+00006580: 656e 7473 2c73 7472 6963 743d 4661 6c73  ents,strict=Fals
+00006590: 6529 0d0a 0d0a 2020 2020 2020 2020 2320  e)....        # 
+000065a0: 5265 7472 6965 7665 2076 616c 7565 730d  Retrieve values.
+000065b0: 0a20 2020 2020 2020 2061 6e73 7765 7220  .        answer 
+000065c0: 3d20 6172 6775 6d65 6e74 735f 6469 6374  = arguments_dict
+000065d0: 5b22 696e 7369 6768 7422 5d0d 0a0d 0a20  ["insight"].... 
+000065e0: 2020 2020 2020 2073 656c 662e 746f 7461         self.tota
+000065f0: 6c5f 746f 6b65 6e73 5f75 7365 642e 6170  l_tokens_used.ap
+00006600: 7065 6e64 2874 6f6b 656e 735f 7573 6564  pend(tokens_used
+00006610: 290d 0a20 2020 2020 2020 2074 6f74 616c  )..        total
+00006620: 5f74 6f6b 656e 735f 7573 6564 5f73 756d  _tokens_used_sum
+00006630: 203d 2073 756d 2873 656c 662e 746f 7461   = sum(self.tota
+00006640: 6c5f 746f 6b65 6e73 5f75 7365 6429 0d0a  l_tokens_used)..
+00006650: 0d0a 2020 2020 2020 2020 2320 5265 7365  ..        # Rese
+00006660: 7420 7468 6520 5374 7269 6e67 494f 2062  t the StringIO b
+00006670: 7566 6665 720d 0a20 2020 2020 2020 206f  uffer..        o
+00006680: 7574 7075 742e 7472 756e 6361 7465 2830  utput.truncate(0
+00006690: 290d 0a20 2020 2020 2020 206f 7574 7075  )..        outpu
+000066a0: 742e 7365 656b 2830 290d 0a0d 0a20 2020  t.seek(0)....   
+000066b0: 2020 2020 2072 6574 7572 6e20 616e 7377       return answ
+000066c0: 6572 2c20 636f 6465 2c20 746f 7461 6c5f  er, code, total_
+000066d0: 746f 6b65 6e73 5f75 7365 645f 7375 6d0d  tokens_used_sum.
+000066e0: 0a20 2020 20                             .
```

### Comparing `bambooai-0.3.4/bambooai/func_calls.py` & `bambooai-0.3.5/bambooai/func_calls.py`

 * *Files identical despite different names*

### Comparing `bambooai-0.3.4/bambooai/prompts.py` & `bambooai-0.3.5/bambooai/prompts.py`

 * *Files identical despite different names*

### Comparing `bambooai-0.3.4/bambooai.egg-info/PKG-INFO` & `bambooai-0.3.5/bambooai.egg-info/PKG-INFO`

 * *Files 0% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: bambooai
-Version: 0.3.4
+Version: 0.3.5
 Summary: A lightweight library for working with pandas dataframes using natural language queries
 Home-page: UNKNOWN
 Author: Palo Galko
 License: UNKNOWN
 Platform: UNKNOWN
 Classifier: Development Status :: 3 - Alpha
 Classifier: License :: OSI Approved :: MIT License
```

### Comparing `bambooai-0.3.4/setup.py` & `bambooai-0.3.5/setup.py`

 * *Files 12% similar despite different names*

```diff
@@ -2,15 +2,15 @@
 import os
 
 with open("README.md", "r") as fh:
     long_description = fh.read()
 
 setup(
     name='bambooai',
-    version='0.3.4',
+    version='0.3.5',
     description='A lightweight library for working with pandas dataframes using natural language queries',
     long_description=long_description,
     long_description_content_type="text/markdown",
     author='Palo Galko',
     packages=find_packages(),
     install_requires=[
         'openai',
```

